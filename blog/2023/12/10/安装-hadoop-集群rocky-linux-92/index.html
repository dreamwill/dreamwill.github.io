
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="我老婆说我是一个执着的人">
      
      
        <meta name="author" content="许王伟">
      
      
        <link rel="canonical" href="https://xuwangwei.com/blog/2023/12/10/%E5%AE%89%E8%A3%85-hadoop-%E9%9B%86%E7%BE%A4rocky-linux-92/">
      
      
        <link rel="prev" href="../../../11/13/%E4%BB%8A%E5%B9%B4%E5%8F%8C%E5%8D%81%E4%B8%80%E6%88%91%E4%B9%B0%E4%BA%86%E4%B8%80%E4%B8%AA-apple-tv/">
      
      
        <link rel="next" href="../%E5%AE%89%E8%A3%85-hadoop-%E8%BF%87%E7%A8%8B%E4%B8%AD%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98%E4%B8%8E%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/">
      
      
      <link rel="icon" href="../../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.11">
    
    
      
        <title>安装 Hadoop 集群(Rocky Linux 9.2) - 许王伟的个人网站</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
    
    
      <link rel="stylesheet" href="../../../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-58Y5WB8P5M"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-58Y5WB8P5M",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-58Y5WB8P5M",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="green">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#hadoop-rocky-linux-92" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../../../.." title="许王伟的个人网站" class="md-header__button md-logo" aria-label="许王伟的个人网站" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            许王伟的个人网站
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              安装 Hadoop 集群(Rocky Linux 9.2)
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="green"  aria-label="Light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="blue"  aria-label="Dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../../../" class="md-tabs__link">
          
  
  
    
  
  博客

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../../mysql/build-env1/" class="md-tabs__link">
          
  
  
    
  
  漫游 MySQL 源码系列

        </a>
      </li>
    
  

    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="许王伟的个人网站" class="md-nav__button md-logo" aria-label="许王伟的个人网站" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    许王伟的个人网站
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    博客
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1" id="__nav_1_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            博客
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_2" >
        
          
          <label class="md-nav__link" for="__nav_1_2" id="__nav_1_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    归档
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_2">
            <span class="md-nav__icon md-icon"></span>
            归档
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2025/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2025
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2024/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2024
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2023/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2023
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_3" >
        
          
          <label class="md-nav__link" for="__nav_1_3" id="__nav_1_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    分类
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_3">
            <span class="md-nav__icon md-icon"></span>
            分类
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/%E5%85%B6%E4%BB%96/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    其他
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/%E5%A5%BD%E7%89%A9%E5%88%86%E4%BA%AB/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    好物分享
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/%E5%AE%89%E8%A3%85/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    安装
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    漫游 MySQL 源码系列
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            漫游 MySQL 源码系列
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    搭建 MySQL 源码阅读和调试环境
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            搭建 MySQL 源码阅读和调试环境
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../mysql/build-env1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Rocky Linux 9
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../mysql/build-env2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Debian 12
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../mysql/connect1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    当客户端输入 mysql -h x.x.x.x -u root -p 时，服务端在做什么（上）
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
                
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      准备用户
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hadoop-zookeeper" class="md-nav__link">
    <span class="md-ellipsis">
      共享家目录、Hadoop 和 ZooKeeper 配置目录
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hadoopzookeeper" class="md-nav__link">
    <span class="md-ellipsis">
      安装Hadoop和ZooKeeper
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kerberos-principalskeytab-files" class="md-nav__link">
    <span class="md-ellipsis">
      准备Kerberos principals和keytab files
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ssltls" class="md-nav__link">
    <span class="md-ellipsis">
      生成自签名 SSL/TLS 证书
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hadoop" class="md-nav__link">
    <span class="md-ellipsis">
      配置Hadoop
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zookeeper" class="md-nav__link">
    <span class="md-ellipsis">
      配置ZooKeeper
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zookeeper_1" class="md-nav__link">
    <span class="md-ellipsis">
      启动ZooKeeper
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hadoop_1" class="md-nav__link">
    <span class="md-ellipsis">
      启动Hadoop
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
  <div class="md-content md-content--post" data-md-component="content">
    <div class="md-sidebar md-sidebar--post" data-md-component="sidebar" data-md-type="navigation">
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner md-post">
          <nav class="md-nav md-nav--primary">
            <div class="md-post__back">
              <div class="md-nav__title md-nav__container">
                <a href="../../../../" class="md-nav__link">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
                  <span class="md-ellipsis">
                    回到主页
                  </span>
                </a>
              </div>
            </div>
            
            <ul class="md-post__meta md-nav__list">
              <li class="md-nav__item md-nav__item--section">
                <div class="md-post__title">
                  <span class="md-ellipsis">
                    元数据
                  </span>
                </div>
                <nav class="md-nav">
                  <ul class="md-nav__list">
                    <li class="md-nav__item">
                      <div class="md-nav__link">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 19H5V8h14m-3-7v2H8V1H6v2H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-1V1m-1 11h-5v5h5z"/></svg>
                        <time datetime="2023-12-10 00:00:00+00:00" class="md-ellipsis">2023年12月10日</time>
                      </div>
                    </li>
                    
                    
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 3v15h3V3zm3 2 4 13 3-1-4-13zM5 5v13h3V5zM3 19v2h18v-2z"/></svg>
                          <span class="md-ellipsis">
                            分类于
                            
                              <a href="../../../../category/%E5%AE%89%E8%A3%85/">安装</a></span>
                        </div>
                      </li>
                    
                    
                  </ul>
                </nav>
              </li>
            </ul>
            
          </nav>
          
        </div>
      </div>
    </div>
    <article class="md-content__inner md-typeset">
      
        
  




<h1 id="hadoop-rocky-linux-92">安装 Hadoop 集群(Rocky Linux 9.2)<a class="headerlink" href="#hadoop-rocky-linux-92" title="Permanent link">&para;</a></h1>
<!-- more -->
<div class="admonition abstract">
<p class="admonition-title">安装目标</p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Hadoop 集群启用 Kerberos 认证。</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> HDFS 由 3 个 NameNode、5 个 DataNode 组成高可用（High Availability）集群。</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> MapReduce 由 1 个 JobHistory Server 组成。</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> YARN 由 2 个 ResourceManager、5 个 NodeManager 组成高可用集群。</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Hadoop 版本是 3.3.6，ZooKeeper 版本是 3.7.1。</li>
</ul>
</div>
<hr />
<div class="admonition note">
<p class="admonition-title">前置条件</p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> 已安装JDK 8。</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> 已安装 FreeIPA。可以参考<a href="../安装freeiparockylinux-9.2/">安装 FreeIPA(Rocky Linux 9.2)</a>。</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> 已编译 container-executor。可以参考<a href="../安装hadoop过程中遇到的问题与解决方案/">安装 Hadoop 过程中遇到的问题与解决方案</a>。</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> 已安装 openssl-1.1.1。可以参考<a href="../安装hadoop过程中遇到的问题与解决方案/">安装 Hadoop 过程中遇到的问题与解决方案</a>。</li>
</ul>
</div>
<hr />
<table>
<thead>
<tr>
<th></th>
<th>ipa-server</th>
<th>ipa-client</th>
<th>namenode</th>
<th>zkfc</th>
<th>journalnode</th>
<th>datanode</th>
<th>jobhistory server</th>
<th>resource manager</th>
<th>node manager</th>
<th>zookeeper</th>
</tr>
</thead>
<tbody>
<tr>
<td>ipa-server</td>
<td>✔️</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>machine1</td>
<td></td>
<td>✔️</td>
<td>✔️</td>
<td>✔️</td>
<td>✔️</td>
<td>✔️</td>
<td>✔️</td>
<td></td>
<td>✔️</td>
<td>✔️</td>
</tr>
<tr>
<td>machine2</td>
<td></td>
<td>✔️</td>
<td>✔️</td>
<td>✔️</td>
<td>✔️</td>
<td>✔️</td>
<td></td>
<td></td>
<td>✔️</td>
<td>✔️</td>
</tr>
<tr>
<td>machine3</td>
<td></td>
<td>✔️</td>
<td>✔️</td>
<td>✔️</td>
<td>✔️</td>
<td>✔️</td>
<td></td>
<td></td>
<td>✔️</td>
<td>✔️</td>
</tr>
<tr>
<td>machine4</td>
<td></td>
<td>✔️</td>
<td></td>
<td></td>
<td></td>
<td>✔️</td>
<td></td>
<td>✔️</td>
<td>✔️</td>
<td>✔️</td>
</tr>
<tr>
<td>machine5</td>
<td></td>
<td>✔️</td>
<td></td>
<td></td>
<td></td>
<td>✔️</td>
<td></td>
<td>✔️</td>
<td>✔️</td>
<td>✔️</td>
</tr>
</tbody>
</table>
<hr />
<p>目录布局</p>
<table>
<thead>
<tr>
<th></th>
<th>User:Group</th>
<th>Permissions</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>/opt/hadoop</td>
<td>root:hadoop</td>
<td>755</td>
<td>环境变量 HADOOP_HOME 的值，是 Hadoop 的家目录</td>
</tr>
<tr>
<td>/etc/hadoop</td>
<td>root:hadoop</td>
<td>755</td>
<td>环境变量 HADOOP_CONF_DIR 的值，是 Hadoop 的配置目录</td>
</tr>
<tr>
<td>/var/lib/hadoop</td>
<td>root:hadoop</td>
<td>770</td>
<td>core-site.xml 中 hadoop.tmp.dir 的值，是 Hadoop 的数据目录</td>
</tr>
<tr>
<td>/var/log/hadoop</td>
<td>hdfs:hadoop</td>
<td>775</td>
<td>环境变量 HADOOP_LOG_DIR 的值，是 Hadoop 的日志目录</td>
</tr>
<tr>
<td>/opt/zookeeper</td>
<td>zookeeper:zookeeper</td>
<td>755</td>
<td>环境变量 ZOO_KEEPER_HOME 的值，是 ZooKeeper 的家目录</td>
</tr>
<tr>
<td>/etc/zookeeper</td>
<td>zookeeper:zookeeper</td>
<td>755</td>
<td>环境变量 ZOOCFGDIR 的值，是 ZooKeeper 的配置目录</td>
</tr>
<tr>
<td>/var/lib/zookeeper</td>
<td>zookeeper:zookeeper</td>
<td>750</td>
<td>zoo.cfg 中 dataDir 的值，是 ZooKeeper 的数据目录</td>
</tr>
<tr>
<td>/var/log/zookeeper</td>
<td>zookeeper:zookeeper</td>
<td>755</td>
<td>环境变量 ZOO_LOG_DIR 的值，是 ZooKeeper 的日志目录</td>
</tr>
</tbody>
</table>
<h2 id="_1">准备用户<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>下面的命令是在主机ipa-server上执行的。</p>
</div>
<ol>
<li>
<p>身份认证</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">[root@ipa-server ~]# </span>kinit<span class="w"> </span>admin
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="go">Password for admin@XUWANGWEI.TEST: </span>
</span></code></pre></div>
</li>
<li>
<p>新增用户组hadoop</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="gp">[root@ipa-server ~]# </span>ipa<span class="w"> </span>group-add<span class="w"> </span>hadoop<span class="w"> </span>--gid<span class="o">=</span><span class="m">1532600004</span>
</span></code></pre></div>
</li>
<li>
<p>新增用户hdfs</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="gp"># </span>添加用户hdfs
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="gp">[root@ipa-server ~]# </span>ipa<span class="w"> </span>user-add<span class="w"> </span>hdfs<span class="w"> </span>--first<span class="o">=</span>hdfs<span class="w"> </span>--last<span class="o">=</span>hadoop<span class="w"> </span>--shell<span class="o">=</span>/bin/bash<span class="w"> </span>--gidnumber<span class="o">=</span><span class="m">1532600004</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="gp"># </span>生成用户hdfs的ssh公钥和私钥
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="gp">[root@ipa-server ~]# </span>su<span class="w"> </span>-<span class="w"> </span>hdfs
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="gp">[hdfs@ipa-server ~]$ </span>ssh-keygen<span class="w"> </span>-t<span class="w"> </span>rsa<span class="w"> </span>-P<span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span>-f<span class="w"> </span>~/.ssh/id_rsa
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="gp">[hdfs@ipa-server ~]$ </span>cat<span class="w"> </span>~/.ssh/id_rsa.pub<span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.ssh/authorized_keys
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="gp">[hdfs@ipa-server ~]$ </span>chmod<span class="w"> </span><span class="m">0600</span><span class="w"> </span>~/.ssh/authorized_keys
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="gp">[hdfs@ipa-server ~]$ </span><span class="nb">exit</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="gp"># </span>上传用户hdfs的ssh公钥
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="gp">[root@ipa-server ~]# </span>ipa<span class="w"> </span>user-mod<span class="w"> </span>hdfs<span class="w"> </span>--sshpubkey<span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span><span class="w"> </span>cat<span class="w"> </span>~hdfs/.ssh/id_rsa.pub<span class="w"> </span><span class="k">)</span><span class="s2">&quot;</span>
</span></code></pre></div>
</li>
<li>
<p>新增用户yarn</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="go">ipa user-add yarn --first=yarn --last=hadoop --shell=/bin/bash --gidnumber=1532600004</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="go">su - yarn</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="go">ssh-keygen -t rsa -P &#39;&#39; -f ~/.ssh/id_rsa</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="go">cat ~/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="go">chmod 0600 ~/.ssh/authorized_keys</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="go">exit</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="go">ipa user-mod yarn --sshpubkey=&quot;$( cat ~yarn/.ssh/id_rsa.pub )&quot;</span>
</span></code></pre></div>
</li>
<li>
<p>新增用户mapred</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="go">ipa user-add mapred --first=mapred --last=hadoop --shell=/bin/bash --gidnumber=1532600004</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="go">su - mapred</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="go">ssh-keygen -t rsa -P &#39;&#39; -f ~/.ssh/id_rsa</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="go">cat ~/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="go">chmod 0600 ~/.ssh/authorized_keys</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="go">exit</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="go">ipa user-mod mapred --sshpubkey=&quot;$( cat ~mapred/.ssh/id_rsa.pub )&quot;</span>
</span></code></pre></div>
</li>
<li>
<p>新增用户zookeeper</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="go">ipa user-add zookeeper --first=zookeeper --last=hadoop --shell=/bin/bash</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="go">su - zookeeper</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="go">ssh-keygen -t rsa -P &#39;&#39; -f ~/.ssh/id_rsa</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="go">cat ~/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="go">chmod 0600 ~/.ssh/authorized_keys</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="go">exit</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="go">ipa user-mod zookeeper --sshpubkey=&quot;$( cat ~zookeeper/.ssh/id_rsa.pub )&quot;</span>
</span></code></pre></div>
</li>
</ol>
<hr />
<h2 id="hadoop-zookeeper">共享家目录、Hadoop 和 ZooKeeper 配置目录<a class="headerlink" href="#hadoop-zookeeper" title="Permanent link">&para;</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>下面的命令是在主机ipa-server上执行的。</p>
</div>
<ol>
<li>
<p>设置防火墙</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>firewall-cmd<span class="w"> </span>--add-service<span class="o">={</span>nfs,rpc-bind,mountd<span class="o">}</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>firewall-cmd<span class="w"> </span>--add-service<span class="o">={</span>nfs,rpc-bind,mountd<span class="o">}</span><span class="w"> </span>--permanent
</span></code></pre></div>
</li>
<li>
<p>修改NFS配置文件/etc/exports，使得主机ipa-server上的/home目录、/etc/hadoop目录和/etc/zookeeper目录共享给其他主机。</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>/home    192.168.2.0/24(rw,sync,no_root_squash)
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>/etc/hadoop    192.168.2.0/24(rw,sync,no_root_squash)
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>/etc/zookeeper 192.168.2.0/24(rw,sync,no_root_squash)
</span></code></pre></div>
</li>
<li>
<p>创建 Hadoop 和 ZooKeeper 配置目录并设置属主属组</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>mkdir<span class="w"> </span>/etc/hadoop
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>chown<span class="w"> </span>root:hadoop<span class="w"> </span>/etc/hadoop
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>chmod<span class="w"> </span><span class="m">755</span><span class="w"> </span>/etc/hadoop
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>mkdir<span class="w"> </span>/etc/zookeeper
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>chown<span class="w"> </span>zookeeper:zookeeper<span class="w"> </span>/etc/zookeeper
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>chmod<span class="w"> </span><span class="m">755</span><span class="w"> </span>/etc/zookeeper
</span></code></pre></div>
</li>
<li>
<p>启动NFS服务</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>systemctl<span class="w"> </span>restart<span class="w"> </span>rpcbind
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>systemctl<span class="w"> </span>restart<span class="w"> </span>nfs-server
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>rpcbind
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>nfs-server
</span></code></pre></div>
</li>
<li>
<p>在IPA Server上创建挂载配置</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>ipa<span class="w"> </span>automountkey-add<span class="w"> </span>default<span class="w"> </span>auto.direct<span class="w"> </span>--key<span class="o">=</span>/home<span class="w"> </span>--info<span class="o">=</span><span class="s2">&quot;-fstype=nfs4,rw ipa-server:/home&quot;</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>ipa<span class="w"> </span>automountkey-add<span class="w"> </span>default<span class="w"> </span>auto.direct<span class="w"> </span>--key<span class="o">=</span>/etc/hadoop<span class="w"> </span>--info<span class="o">=</span><span class="s2">&quot;-fstype=nfs4,rw ipa-server:/etc/hadoop&quot;</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>ipa<span class="w"> </span>automountkey-add<span class="w"> </span>default<span class="w"> </span>auto.direct<span class="w"> </span>--key<span class="o">=</span>/etc/zookeeper<span class="w"> </span>--info<span class="o">=</span><span class="s2">&quot;-fstype=nfs4,rw ipa-server:/etc/zookeeper&quot;</span>
</span></code></pre></div>
</li>
</ol>
<hr />
<h2 id="hadoopzookeeper">安装Hadoop和ZooKeeper<a class="headerlink" href="#hadoopzookeeper" title="Permanent link">&para;</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>下面的命令需要在主机machine1~machine5上执行。</p>
</div>
<ol>
<li>
<p>关闭防火墙</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>systemctl<span class="w"> </span>stop<span class="w"> </span>firewalld
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>systemctl<span class="w"> </span>disable<span class="w"> </span>firewalld
</span></code></pre></div>
</li>
<li>
<p>下载和解压</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="nb">cd</span><span class="w"> </span>/opt
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>curl<span class="w"> </span>-O<span class="w"> </span>https://dlcdn.apache.org/zookeeper/zookeeper-3.7.1/apache-zookeeper-3.7.1-bin.tar.gz
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>tar<span class="w"> </span>-zxf<span class="w"> </span>apache-zookeeper-3.7.1-bin.tar.gz
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>curl<span class="w"> </span>-O<span class="w"> </span>https://dlcdn.apache.org/hadoop/common/hadoop-3.3.6/hadoop-3.3.6.tar.gz
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>tar<span class="w"> </span>-zxf<span class="w"> </span>hadoop-3.3.6.tar.gz
</span></code></pre></div>
</li>
<li>
<p>创建别名</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>ln<span class="w"> </span>-s<span class="w"> </span>apache-zookeeper-3.7.1-bin<span class="w"> </span>zookeeper
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>ln<span class="w"> </span>-s<span class="w"> </span>hadoop-3.3.6<span class="w"> </span>hadoop
</span></code></pre></div>
</li>
<li>
<p>添加环境变量</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;export ZOO_KEEPER_HOME=/opt/zookeeper&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>/etc/profile.d/zookeeper.sh
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;export PATH=$PATH:$ZOO_KEEPER_HOME/bin&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>/etc/profile.d/zookeeper.sh
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;export ZOOCFGDIR=/etc/zookeeper&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>/etc/profile.d/zookeeper.sh
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;export ZOO_LOG_DIR=/var/log/zookeeper&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>/etc/profile.d/zookeeper.sh
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="nb">source</span><span class="w"> </span>/etc/profile.d/zookeeper.sh
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;export HADOOP_HOME=/opt/hadoop&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>/etc/profile.d/hadoop.sh
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;export PATH=$PATH:$HADOOP_HOME/bin:$HADOOP_HOME/sbin&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>/etc/profile.d/hadoop.sh
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;export HADOOP_CONF_DIR=/etc/hadoop&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>/etc/profile.d/hadoop.sh
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;export HADOOP_LOG_DIR=/var/log/hadoop&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>/etc/profile.d/hadoop.sh
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;export HADOOP_OPTS=&quot;-Djava.security.auth.login.config=/etc/hadoop/jaas.conf&quot;&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>/etc/profile.d/hadoop.sh
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="nb">source</span><span class="w"> </span>/etc/profile.d/hadoop.sh
</span></code></pre></div>
</li>
<li>
<p>创建数据目录并设置属主属组</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>chown<span class="w"> </span>-R<span class="w"> </span>-H<span class="w"> </span>zookeeper:zookeeper<span class="w"> </span><span class="nv">$ZOO_KEEPER_HOME</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>mkdir<span class="w"> </span>/var/lib/zookeeper
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>chown<span class="w"> </span>zookeeper:zookeeper<span class="w"> </span>/var/lib/zookeeper
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>chmod<span class="w"> </span><span class="m">750</span><span class="w"> </span>/var/lib/zookeeper
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>mkdir<span class="w"> </span>/var/log/zookeeper
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>chown<span class="w"> </span>zookeeper:zookeeper<span class="w"> </span>/var/log/zookeeper
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>chmod<span class="w"> </span><span class="m">755</span><span class="w"> </span>/var/log/zookeeper
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>chown<span class="w"> </span>-R<span class="w"> </span>-H<span class="w"> </span>root:hadoop<span class="w"> </span><span class="nv">$HADOOP_HOME</span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>chmod<span class="w"> </span><span class="m">755</span><span class="w"> </span><span class="nv">$HADOOP_HOME</span>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a>chown<span class="w"> </span>root:hadoop<span class="w"> </span><span class="nv">$HADOOP_HOME</span>/bin/container-executor
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a>chmod<span class="w"> </span><span class="m">6050</span><span class="w"> </span><span class="nv">$HADOOP_HOME</span>/bin/container-executor<span class="w"> </span>
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a>mkdir<span class="w"> </span>/var/lib/hadoop
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a>chown<span class="w"> </span>root:hadoop<span class="w"> </span>/var/lib/hadoop
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a>chmod<span class="w"> </span><span class="m">770</span><span class="w"> </span>/var/lib/hadoop
</span><span id="__span-15-15"><a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a>mkdir<span class="w"> </span>/var/log/hadoop
</span><span id="__span-15-16"><a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a>chown<span class="w"> </span>hdfs:hadoop<span class="w"> </span>/var/log/hadoop
</span><span id="__span-15-17"><a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a>chmod<span class="w"> </span><span class="m">775</span><span class="w"> </span>/var/log/hadoop
</span></code></pre></div>
</li>
<li>
<p>创建 Hadoop 和 ZooKeeper 配置目录并设置属主属组</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>mkdir<span class="w"> </span>/etc/hadoop
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>chown<span class="w"> </span>root:hadoop<span class="w"> </span>/etc/hadoop
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>chmod<span class="w"> </span><span class="m">755</span><span class="w"> </span>/etc/hadoop
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>mkdir<span class="w"> </span>/etc/zookeeper
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>chown<span class="w"> </span>zookeeper:zookeeper<span class="w"> </span>/etc/zookeeper
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>chmod<span class="w"> </span><span class="m">755</span><span class="w"> </span>/etc/zookeeper
</span></code></pre></div>
</li>
<li>
<p>客户端挂载家目录、/etc/hadoop 和/etc/zookeeper 目录</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>ipa-client-automount<span class="w"> </span>--location<span class="o">=</span>default
</span></code></pre></div>
</li>
<li>
<p>复制配置文件至共享目录</p>
</li>
</ol>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>下面的命令是在主机 machine1 上执行的，目的是把默认配置文件复制到共享目录中。</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>cp<span class="w"> </span>-a<span class="w"> </span>-r<span class="w"> </span>/opt/hadoop/etc/hadoop/*<span class="w"> </span>/etc/hadoop
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>chown<span class="w"> </span>root:hadoop<span class="w"> </span>/etc/hadoop/container-executor.cfg
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>chmod<span class="w"> </span><span class="m">0400</span><span class="w"> </span>/etc/hadoop/container-executor.cfg
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>cp<span class="w"> </span>-a<span class="w"> </span>-r<span class="w"> </span>/opt/zookeeper/conf/*<span class="w"> </span>/etc/zookeeper
</span></code></pre></div>
</div>
<hr />
<h2 id="kerberos-principalskeytab-files">准备Kerberos principals和keytab files<a class="headerlink" href="#kerberos-principalskeytab-files" title="Permanent link">&para;</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>下面的命令是在主机ipa-server上执行的。</p>
</div>
<ol>
<li>
<p>创建principal</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>ipa<span class="w"> </span>service-add<span class="w"> </span>hdfs/machine1.xuwangwei.test@XUWANGWEI.TEST<span class="w"> </span>--requires-pre-auth<span class="o">=</span><span class="nb">true</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>ipa<span class="w"> </span>service-add<span class="w"> </span>HTTP/machine1.xuwangwei.test@XUWANGWEI.TEST<span class="w"> </span>--requires-pre-auth<span class="o">=</span><span class="nb">true</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>ipa<span class="w"> </span>service-add<span class="w"> </span>yarn/machine1.xuwangwei.test@XUWANGWEI.TEST<span class="w"> </span>--requires-pre-auth<span class="o">=</span><span class="nb">true</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>ipa<span class="w"> </span>service-add<span class="w"> </span>mapred/machine1.xuwangwei.test@XUWANGWEI.TEST<span class="w"> </span>--requires-pre-auth<span class="o">=</span><span class="nb">true</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>ipa<span class="w"> </span>service-add<span class="w"> </span>hdfs/machine2.xuwangwei.test@XUWANGWEI.TEST<span class="w"> </span>--requires-pre-auth<span class="o">=</span><span class="nb">true</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>ipa<span class="w"> </span>service-add<span class="w"> </span>HTTP/machine2.xuwangwei.test@XUWANGWEI.TEST<span class="w"> </span>--requires-pre-auth<span class="o">=</span><span class="nb">true</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a>ipa<span class="w"> </span>service-add<span class="w"> </span>yarn/machine2.xuwangwei.test@XUWANGWEI.TEST<span class="w"> </span>--requires-pre-auth<span class="o">=</span><span class="nb">true</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a>ipa<span class="w"> </span>service-add<span class="w"> </span>hdfs/machine3.xuwangwei.test@XUWANGWEI.TEST<span class="w"> </span>--requires-pre-auth<span class="o">=</span><span class="nb">true</span>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a>ipa<span class="w"> </span>service-add<span class="w"> </span>HTTP/machine3.xuwangwei.test@XUWANGWEI.TEST<span class="w"> </span>--requires-pre-auth<span class="o">=</span><span class="nb">true</span>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a>ipa<span class="w"> </span>service-add<span class="w"> </span>yarn/machine3.xuwangwei.test@XUWANGWEI.TEST<span class="w"> </span>--requires-pre-auth<span class="o">=</span><span class="nb">true</span>
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a>ipa<span class="w"> </span>service-add<span class="w"> </span>hdfs/machine4.xuwangwei.test@XUWANGWEI.TEST<span class="w"> </span>--requires-pre-auth<span class="o">=</span><span class="nb">true</span>
</span><span id="__span-19-12"><a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a>ipa<span class="w"> </span>service-add<span class="w"> </span>HTTP/machine4.xuwangwei.test@XUWANGWEI.TEST<span class="w"> </span>--requires-pre-auth<span class="o">=</span><span class="nb">true</span>
</span><span id="__span-19-13"><a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a>ipa<span class="w"> </span>service-add<span class="w"> </span>yarn/machine4.xuwangwei.test@XUWANGWEI.TEST<span class="w"> </span>--requires-pre-auth<span class="o">=</span><span class="nb">true</span>
</span><span id="__span-19-14"><a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a>ipa<span class="w"> </span>service-add<span class="w"> </span>hdfs/machine5.xuwangwei.test@XUWANGWEI.TEST<span class="w"> </span>--requires-pre-auth<span class="o">=</span><span class="nb">true</span>
</span><span id="__span-19-15"><a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a>ipa<span class="w"> </span>service-add<span class="w"> </span>HTTP/machine5.xuwangwei.test@XUWANGWEI.TEST<span class="w"> </span>--requires-pre-auth<span class="o">=</span><span class="nb">true</span>
</span><span id="__span-19-16"><a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a>ipa<span class="w"> </span>service-add<span class="w"> </span>yarn/machine5.xuwangwei.test@XUWANGWEI.TEST<span class="w"> </span>--requires-pre-auth<span class="o">=</span><span class="nb">true</span>
</span><span id="__span-19-17"><a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a>ipa<span class="w"> </span>service-add<span class="w"> </span>zookeeper/machine1.xuwangwei.test@XUWANGWEI.TEST<span class="w"> </span>--requires-pre-auth<span class="o">=</span><span class="nb">true</span>
</span><span id="__span-19-18"><a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a>ipa<span class="w"> </span>service-add<span class="w"> </span>zookeeper/machine2.xuwangwei.test@XUWANGWEI.TEST<span class="w"> </span>--requires-pre-auth<span class="o">=</span><span class="nb">true</span>
</span><span id="__span-19-19"><a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a>ipa<span class="w"> </span>service-add<span class="w"> </span>zookeeper/machine3.xuwangwei.test@XUWANGWEI.TEST<span class="w"> </span>--requires-pre-auth<span class="o">=</span><span class="nb">true</span>
</span><span id="__span-19-20"><a id="__codelineno-19-20" name="__codelineno-19-20" href="#__codelineno-19-20"></a>ipa<span class="w"> </span>service-add<span class="w"> </span>zookeeper/machine4.xuwangwei.test@XUWANGWEI.TEST<span class="w"> </span>--requires-pre-auth<span class="o">=</span><span class="nb">true</span>
</span><span id="__span-19-21"><a id="__codelineno-19-21" name="__codelineno-19-21" href="#__codelineno-19-21"></a>ipa<span class="w"> </span>service-add<span class="w"> </span>zookeeper/machine5.xuwangwei.test@XUWANGWEI.TEST<span class="w"> </span>--requires-pre-auth<span class="o">=</span><span class="nb">true</span>
</span></code></pre></div>
</li>
<li>
<p>导出principal的密钥</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>ipa-getkeytab<span class="w"> </span>--principal<span class="o">=</span>hdfs/machine1.xuwangwei.test@XUWANGWEI.TEST<span class="w"> </span>--keytab<span class="o">=</span>/etc/hadoop/hdfs.keytab<span class="w"> </span>--enctypes<span class="o">=</span>aes256-sha1,aes128-sha1
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>ipa-getkeytab<span class="w"> </span>--principal<span class="o">=</span>HTTP/machine1.xuwangwei.test@XUWANGWEI.TEST<span class="w"> </span>--keytab<span class="o">=</span>/etc/hadoop/hdfs.keytab<span class="w"> </span>--enctypes<span class="o">=</span>aes256-sha1,aes128-sha1
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>ipa-getkeytab<span class="w"> </span>--principal<span class="o">=</span>hdfs/machine2.xuwangwei.test@XUWANGWEI.TEST<span class="w"> </span>--keytab<span class="o">=</span>/etc/hadoop/hdfs.keytab<span class="w"> </span>--enctypes<span class="o">=</span>aes256-sha1,aes128-sha1
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>ipa-getkeytab<span class="w"> </span>--principal<span class="o">=</span>HTTP/machine2.xuwangwei.test@XUWANGWEI.TEST<span class="w"> </span>--keytab<span class="o">=</span>/etc/hadoop/hdfs.keytab<span class="w"> </span>--enctypes<span class="o">=</span>aes256-sha1,aes128-sha1
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>ipa-getkeytab<span class="w"> </span>--principal<span class="o">=</span>hdfs/machine3.xuwangwei.test@XUWANGWEI.TEST<span class="w"> </span>--keytab<span class="o">=</span>/etc/hadoop/hdfs.keytab<span class="w"> </span>--enctypes<span class="o">=</span>aes256-sha1,aes128-sha1
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>ipa-getkeytab<span class="w"> </span>--principal<span class="o">=</span>HTTP/machine3.xuwangwei.test@XUWANGWEI.TEST<span class="w"> </span>--keytab<span class="o">=</span>/etc/hadoop/hdfs.keytab<span class="w"> </span>--enctypes<span class="o">=</span>aes256-sha1,aes128-sha1
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>ipa-getkeytab<span class="w"> </span>--principal<span class="o">=</span>hdfs/machine4.xuwangwei.test@XUWANGWEI.TEST<span class="w"> </span>--keytab<span class="o">=</span>/etc/hadoop/hdfs.keytab<span class="w"> </span>--enctypes<span class="o">=</span>aes256-sha1,aes128-sha1
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>ipa-getkeytab<span class="w"> </span>--principal<span class="o">=</span>HTTP/machine4.xuwangwei.test@XUWANGWEI.TEST<span class="w"> </span>--keytab<span class="o">=</span>/etc/hadoop/hdfs.keytab<span class="w"> </span>--enctypes<span class="o">=</span>aes256-sha1,aes128-sha1
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a>ipa-getkeytab<span class="w"> </span>--principal<span class="o">=</span>hdfs/machine5.xuwangwei.test@XUWANGWEI.TEST<span class="w"> </span>--keytab<span class="o">=</span>/etc/hadoop/hdfs.keytab<span class="w"> </span>--enctypes<span class="o">=</span>aes256-sha1,aes128-sha1
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a>ipa-getkeytab<span class="w"> </span>--principal<span class="o">=</span>HTTP/machine5.xuwangwei.test@XUWANGWEI.TEST<span class="w"> </span>--keytab<span class="o">=</span>/etc/hadoop/hdfs.keytab<span class="w"> </span>--enctypes<span class="o">=</span>aes256-sha1,aes128-sha1
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a>ipa-getkeytab<span class="w"> </span>--principal<span class="o">=</span>HTTP/machine1.xuwangwei.test@XUWANGWEI.TEST<span class="w"> </span>--keytab<span class="o">=</span>/etc/hadoop/yarn.keytab<span class="w"> </span>--enctypes<span class="o">=</span>aes256-sha1,aes128-sha1
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a>ipa-getkeytab<span class="w"> </span>--principal<span class="o">=</span>yarn/machine1.xuwangwei.test@XUWANGWEI.TEST<span class="w"> </span>--keytab<span class="o">=</span>/etc/hadoop/yarn.keytab<span class="w"> </span>--enctypes<span class="o">=</span>aes256-sha1,aes128-sha1
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a>ipa-getkeytab<span class="w"> </span>--principal<span class="o">=</span>HTTP/machine2.xuwangwei.test@XUWANGWEI.TEST<span class="w"> </span>--keytab<span class="o">=</span>/etc/hadoop/yarn.keytab<span class="w"> </span>--enctypes<span class="o">=</span>aes256-sha1,aes128-sha1
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a>ipa-getkeytab<span class="w"> </span>--principal<span class="o">=</span>yarn/machine2.xuwangwei.test@XUWANGWEI.TEST<span class="w"> </span>--keytab<span class="o">=</span>/etc/hadoop/yarn.keytab<span class="w"> </span>--enctypes<span class="o">=</span>aes256-sha1,aes128-sha1
</span><span id="__span-20-15"><a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a>ipa-getkeytab<span class="w"> </span>--principal<span class="o">=</span>HTTP/machine3.xuwangwei.test@XUWANGWEI.TEST<span class="w"> </span>--keytab<span class="o">=</span>/etc/hadoop/yarn.keytab<span class="w"> </span>--enctypes<span class="o">=</span>aes256-sha1,aes128-sha1
</span><span id="__span-20-16"><a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a>ipa-getkeytab<span class="w"> </span>--principal<span class="o">=</span>yarn/machine3.xuwangwei.test@XUWANGWEI.TEST<span class="w"> </span>--keytab<span class="o">=</span>/etc/hadoop/yarn.keytab<span class="w"> </span>--enctypes<span class="o">=</span>aes256-sha1,aes128-sha1
</span><span id="__span-20-17"><a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a>ipa-getkeytab<span class="w"> </span>--principal<span class="o">=</span>HTTP/machine4.xuwangwei.test@XUWANGWEI.TEST<span class="w"> </span>--keytab<span class="o">=</span>/etc/hadoop/yarn.keytab<span class="w"> </span>--enctypes<span class="o">=</span>aes256-sha1,aes128-sha1
</span><span id="__span-20-18"><a id="__codelineno-20-18" name="__codelineno-20-18" href="#__codelineno-20-18"></a>ipa-getkeytab<span class="w"> </span>--principal<span class="o">=</span>yarn/machine4.xuwangwei.test@XUWANGWEI.TEST<span class="w"> </span>--keytab<span class="o">=</span>/etc/hadoop/yarn.keytab<span class="w"> </span>--enctypes<span class="o">=</span>aes256-sha1,aes128-sha1
</span><span id="__span-20-19"><a id="__codelineno-20-19" name="__codelineno-20-19" href="#__codelineno-20-19"></a>ipa-getkeytab<span class="w"> </span>--principal<span class="o">=</span>HTTP/machine5.xuwangwei.test@XUWANGWEI.TEST<span class="w"> </span>--keytab<span class="o">=</span>/etc/hadoop/yarn.keytab<span class="w"> </span>--enctypes<span class="o">=</span>aes256-sha1,aes128-sha1
</span><span id="__span-20-20"><a id="__codelineno-20-20" name="__codelineno-20-20" href="#__codelineno-20-20"></a>ipa-getkeytab<span class="w"> </span>--principal<span class="o">=</span>yarn/machine5.xuwangwei.test@XUWANGWEI.TEST<span class="w"> </span>--keytab<span class="o">=</span>/etc/hadoop/yarn.keytab<span class="w"> </span>--enctypes<span class="o">=</span>aes256-sha1,aes128-sha1
</span><span id="__span-20-21"><a id="__codelineno-20-21" name="__codelineno-20-21" href="#__codelineno-20-21"></a>ipa-getkeytab<span class="w"> </span>--principal<span class="o">=</span>mapred/machine1.xuwangwei.test@XUWANGWEI.TEST<span class="w"> </span>--keytab<span class="o">=</span>/etc/hadoop/mapred.keytab<span class="w"> </span>--enctypes<span class="o">=</span>aes256-sha1,aes128-sha1
</span><span id="__span-20-22"><a id="__codelineno-20-22" name="__codelineno-20-22" href="#__codelineno-20-22"></a>ipa-getkeytab<span class="w"> </span>--principal<span class="o">=</span>hdfs@XUWANGWEI.TEST<span class="w"> </span>--keytab<span class="o">=</span>/etc/hadoop/hdfs.keytab<span class="w"> </span>--enctypes<span class="o">=</span>aes256-sha1,aes128-sha1
</span><span id="__span-20-23"><a id="__codelineno-20-23" name="__codelineno-20-23" href="#__codelineno-20-23"></a>ipa-getkeytab<span class="w"> </span>--principal<span class="o">=</span>yarn@XUWANGWEI.TEST<span class="w"> </span>--keytab<span class="o">=</span>/etc/hadoop/yarn.keytab<span class="w"> </span>--enctypes<span class="o">=</span>aes256-sha1,aes128-sha1
</span><span id="__span-20-24"><a id="__codelineno-20-24" name="__codelineno-20-24" href="#__codelineno-20-24"></a>ipa-getkeytab<span class="w"> </span>--principal<span class="o">=</span>mapred@XUWANGWEI.TEST<span class="w"> </span>--keytab<span class="o">=</span>/etc/hadoop/mapred.keytab<span class="w"> </span>--enctypes<span class="o">=</span>aes256-sha1,aes128-sha1
</span><span id="__span-20-25"><a id="__codelineno-20-25" name="__codelineno-20-25" href="#__codelineno-20-25"></a>ipa-getkeytab<span class="w"> </span>--principal<span class="o">=</span>zookeeper/machine1.xuwangwei.test@XUWANGWEI.TEST<span class="w"> </span>--keytab<span class="o">=</span>/etc/zookeeper/zookeeper.keytab<span class="w"> </span>--enctypes<span class="o">=</span>aes256-sha1,aes128-sha1
</span><span id="__span-20-26"><a id="__codelineno-20-26" name="__codelineno-20-26" href="#__codelineno-20-26"></a>ipa-getkeytab<span class="w"> </span>--principal<span class="o">=</span>zookeeper/machine2.xuwangwei.test@XUWANGWEI.TEST<span class="w"> </span>--keytab<span class="o">=</span>/etc/zookeeper/zookeeper.keytab<span class="w"> </span>--enctypes<span class="o">=</span>aes256-sha1,aes128-sha1
</span><span id="__span-20-27"><a id="__codelineno-20-27" name="__codelineno-20-27" href="#__codelineno-20-27"></a>ipa-getkeytab<span class="w"> </span>--principal<span class="o">=</span>zookeeper/machine3.xuwangwei.test@XUWANGWEI.TEST<span class="w"> </span>--keytab<span class="o">=</span>/etc/zookeeper/zookeeper.keytab<span class="w"> </span>--enctypes<span class="o">=</span>aes256-sha1,aes128-sha1
</span><span id="__span-20-28"><a id="__codelineno-20-28" name="__codelineno-20-28" href="#__codelineno-20-28"></a>ipa-getkeytab<span class="w"> </span>--principal<span class="o">=</span>zookeeper/machine4.xuwangwei.test@XUWANGWEI.TEST<span class="w"> </span>--keytab<span class="o">=</span>/etc/zookeeper/zookeeper.keytab<span class="w"> </span>--enctypes<span class="o">=</span>aes256-sha1,aes128-sha1
</span><span id="__span-20-29"><a id="__codelineno-20-29" name="__codelineno-20-29" href="#__codelineno-20-29"></a>ipa-getkeytab<span class="w"> </span>--principal<span class="o">=</span>zookeeper/machine5.xuwangwei.test@XUWANGWEI.TEST<span class="w"> </span>--keytab<span class="o">=</span>/etc/zookeeper/zookeeper.keytab<span class="w"> </span>--enctypes<span class="o">=</span>aes256-sha1,aes128-sha1
</span><span id="__span-20-30"><a id="__codelineno-20-30" name="__codelineno-20-30" href="#__codelineno-20-30"></a>ipa-getkeytab<span class="w"> </span>--principal<span class="o">=</span>zookeeper@XUWANGWEI.TEST<span class="w"> </span>--keytab<span class="o">=</span>/etc/zookeeper/zookeeper.keytab<span class="w"> </span>--enctypes<span class="o">=</span>aes256-sha1,aes128-sha1
</span></code></pre></div>
</li>
<li>
<p>修改keytab的属主属组和权限</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>chown<span class="w"> </span>root:hadoop<span class="w"> </span>/etc/hadoop/*.keytab
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>chmod<span class="w"> </span><span class="m">640</span><span class="w"> </span>/etc/hadoop/*.keytab
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>chown<span class="w"> </span>root:zookeeper<span class="w"> </span>/etc/zookeeper/*.keytab
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>chmod<span class="w"> </span><span class="m">640</span><span class="w"> </span>/etc/zookeeper/*.keytab
</span></code></pre></div>
</li>
</ol>
<hr />
<h2 id="ssltls">生成自签名 SSL/TLS 证书<a class="headerlink" href="#ssltls" title="Permanent link">&para;</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>下面的命令是在主机ipa-server上执行的。</p>
</div>
<ol>
<li>
<p>切换至 root 用户家目录</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="nb">cd</span><span class="w"> </span>/root
</span></code></pre></div>
</li>
<li>
<p>生成自签名证书</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>openssl<span class="w"> </span>req<span class="w"> </span>-newkey<span class="w"> </span>rsa:2048<span class="w"> </span>-keyout<span class="w"> </span>domain1.key<span class="w"> </span>-x509<span class="w"> </span>-days<span class="w"> </span><span class="m">365</span><span class="w"> </span>-out<span class="w"> </span>domain1.crt<span class="w"> </span>-subj<span class="o">=</span><span class="s2">&quot;/C=CN/ST=Jiangsu/L=Changzhou/CN=machine1.xuwangwei.test&quot;</span><span class="w"> </span>-noenc
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>openssl<span class="w"> </span>req<span class="w"> </span>-newkey<span class="w"> </span>rsa:2048<span class="w"> </span>-keyout<span class="w"> </span>domain2.key<span class="w"> </span>-x509<span class="w"> </span>-days<span class="w"> </span><span class="m">365</span><span class="w"> </span>-out<span class="w"> </span>domain2.crt<span class="w"> </span>-subj<span class="o">=</span><span class="s2">&quot;/C=CN/ST=Jiangsu/L=Changzhou/CN=machine2.xuwangwei.test&quot;</span><span class="w"> </span>-noenc
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>openssl<span class="w"> </span>req<span class="w"> </span>-newkey<span class="w"> </span>rsa:2048<span class="w"> </span>-keyout<span class="w"> </span>domain3.key<span class="w"> </span>-x509<span class="w"> </span>-days<span class="w"> </span><span class="m">365</span><span class="w"> </span>-out<span class="w"> </span>domain3.crt<span class="w"> </span>-subj<span class="o">=</span><span class="s2">&quot;/C=CN/ST=Jiangsu/L=Changzhou/CN=machine3.xuwangwei.test&quot;</span><span class="w"> </span>-noenc
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>openssl<span class="w"> </span>req<span class="w"> </span>-newkey<span class="w"> </span>rsa:2048<span class="w"> </span>-keyout<span class="w"> </span>domain4.key<span class="w"> </span>-x509<span class="w"> </span>-days<span class="w"> </span><span class="m">365</span><span class="w"> </span>-out<span class="w"> </span>domain4.crt<span class="w"> </span>-subj<span class="o">=</span><span class="s2">&quot;/C=CN/ST=Jiangsu/L=Changzhou/CN=machine4.xuwangwei.test&quot;</span><span class="w"> </span>-noenc
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>openssl<span class="w"> </span>req<span class="w"> </span>-newkey<span class="w"> </span>rsa:2048<span class="w"> </span>-keyout<span class="w"> </span>domain5.key<span class="w"> </span>-x509<span class="w"> </span>-days<span class="w"> </span><span class="m">365</span><span class="w"> </span>-out<span class="w"> </span>domain5.crt<span class="w"> </span>-subj<span class="o">=</span><span class="s2">&quot;/C=CN/ST=Jiangsu/L=Changzhou/CN=machine5.xuwangwei.test&quot;</span><span class="w"> </span>-noenc
</span></code></pre></div>
</li>
<li>
<p>转化成 PKCS12 格式</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>openssl<span class="w"> </span>pkcs12<span class="w"> </span>-inkey<span class="w"> </span>domain1.key<span class="w"> </span>-in<span class="w"> </span>domain1.crt<span class="w"> </span>-export<span class="w"> </span>-out<span class="w"> </span>domain1.p12<span class="w"> </span>-password<span class="w"> </span>pass:xuwangwei3306
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>openssl<span class="w"> </span>pkcs12<span class="w"> </span>-inkey<span class="w"> </span>domain2.key<span class="w"> </span>-in<span class="w"> </span>domain2.crt<span class="w"> </span>-export<span class="w"> </span>-out<span class="w"> </span>domain2.p12<span class="w"> </span>-password<span class="w"> </span>pass:xuwangwei3306
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>openssl<span class="w"> </span>pkcs12<span class="w"> </span>-inkey<span class="w"> </span>domain3.key<span class="w"> </span>-in<span class="w"> </span>domain3.crt<span class="w"> </span>-export<span class="w"> </span>-out<span class="w"> </span>domain3.p12<span class="w"> </span>-password<span class="w"> </span>pass:xuwangwei3306
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>openssl<span class="w"> </span>pkcs12<span class="w"> </span>-inkey<span class="w"> </span>domain4.key<span class="w"> </span>-in<span class="w"> </span>domain4.crt<span class="w"> </span>-export<span class="w"> </span>-out<span class="w"> </span>domain4.p12<span class="w"> </span>-password<span class="w"> </span>pass:xuwangwei3306
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>openssl<span class="w"> </span>pkcs12<span class="w"> </span>-inkey<span class="w"> </span>domain5.key<span class="w"> </span>-in<span class="w"> </span>domain5.crt<span class="w"> </span>-export<span class="w"> </span>-out<span class="w"> </span>domain5.p12<span class="w"> </span>-password<span class="w"> </span>pass:xuwangwei3306
</span></code></pre></div>
</li>
<li>
<p>通过keytool把 5 个证书和对应私钥全部导入hadoop.p12</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>keytool<span class="w"> </span>-importkeystore<span class="w"> </span>-srckeystore<span class="w"> </span>domain1.p12<span class="w"> </span>-srcstoretype<span class="w"> </span>pkcs12<span class="w"> </span>-srcstorepass<span class="w"> </span>xuwangwei3306<span class="w"> </span>-srcalias<span class="w"> </span><span class="m">1</span><span class="w"> </span>-destkeystore<span class="w"> </span>hadoop.p12<span class="w"> </span>-deststoretype<span class="w"> </span>pkcs12<span class="w"> </span>-deststorepass<span class="w"> </span>xuwangwei3306<span class="w"> </span>-destalias<span class="w"> </span>m1
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>keytool<span class="w"> </span>-importkeystore<span class="w"> </span>-srckeystore<span class="w"> </span>domain2.p12<span class="w"> </span>-srcstoretype<span class="w"> </span>pkcs12<span class="w"> </span>-srcstorepass<span class="w"> </span>xuwangwei3306<span class="w"> </span>-srcalias<span class="w"> </span><span class="m">1</span><span class="w"> </span>-destkeystore<span class="w"> </span>hadoop.p12<span class="w"> </span>-deststoretype<span class="w"> </span>pkcs12<span class="w"> </span>-deststorepass<span class="w"> </span>xuwangwei3306<span class="w"> </span>-destalias<span class="w"> </span>m2
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>keytool<span class="w"> </span>-importkeystore<span class="w"> </span>-srckeystore<span class="w"> </span>domain3.p12<span class="w"> </span>-srcstoretype<span class="w"> </span>pkcs12<span class="w"> </span>-srcstorepass<span class="w"> </span>xuwangwei3306<span class="w"> </span>-srcalias<span class="w"> </span><span class="m">1</span><span class="w"> </span>-destkeystore<span class="w"> </span>hadoop.p12<span class="w"> </span>-deststoretype<span class="w"> </span>pkcs12<span class="w"> </span>-deststorepass<span class="w"> </span>xuwangwei3306<span class="w"> </span>-destalias<span class="w"> </span>m3
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>keytool<span class="w"> </span>-importkeystore<span class="w"> </span>-srckeystore<span class="w"> </span>domain4.p12<span class="w"> </span>-srcstoretype<span class="w"> </span>pkcs12<span class="w"> </span>-srcstorepass<span class="w"> </span>xuwangwei3306<span class="w"> </span>-srcalias<span class="w"> </span><span class="m">1</span><span class="w"> </span>-destkeystore<span class="w"> </span>hadoop.p12<span class="w"> </span>-deststoretype<span class="w"> </span>pkcs12<span class="w"> </span>-deststorepass<span class="w"> </span>xuwangwei3306<span class="w"> </span>-destalias<span class="w"> </span>m4
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>keytool<span class="w"> </span>-importkeystore<span class="w"> </span>-srckeystore<span class="w"> </span>domain5.p12<span class="w"> </span>-srcstoretype<span class="w"> </span>pkcs12<span class="w"> </span>-srcstorepass<span class="w"> </span>xuwangwei3306<span class="w"> </span>-srcalias<span class="w"> </span><span class="m">1</span><span class="w"> </span>-destkeystore<span class="w"> </span>hadoop.p12<span class="w"> </span>-deststoretype<span class="w"> </span>pkcs12<span class="w"> </span>-deststorepass<span class="w"> </span>xuwangwei3306<span class="w"> </span>-destalias<span class="w"> </span>m5
</span></code></pre></div>
</li>
<li>
<p>复制到配置目录</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>cp<span class="w"> </span>hadoop.p12<span class="w"> </span>/etc/hadoop/
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>chown<span class="w"> </span>root:hadoop<span class="w"> </span>/etc/hadoop/hadoop.p12
</span></code></pre></div>
</li>
</ol>
<hr />
<h2 id="hadoop">配置Hadoop<a class="headerlink" href="#hadoop" title="Permanent link">&para;</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>下面的命令只需在主机machine1上执行。</p>
</div>
<ol>
<li>
<p>修改配置文件$HADOOP_CONF_DIR/core-site.xml</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="cp">&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;configuration.xsl&quot;?&gt;</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="cm">&lt;!--</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="cm">Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="cm">you may not use this file except in compliance with the License.</span>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="cm">You may obtain a copy of the License at</span>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a>
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a><span class="cm">    http://www.apache.org/licenses/LICENSE-2.0</span>
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a>
</span><span id="__span-27-10"><a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a><span class="cm">Unless required by applicable law or agreed to in writing, software</span>
</span><span id="__span-27-11"><a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a><span class="cm">distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
</span><span id="__span-27-12"><a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a><span class="cm">WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
</span><span id="__span-27-13"><a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a><span class="cm">See the License for the specific language governing permissions and</span>
</span><span id="__span-27-14"><a id="__codelineno-27-14" name="__codelineno-27-14" href="#__codelineno-27-14"></a><span class="cm">limitations under the License. See accompanying LICENSE file.</span>
</span><span id="__span-27-15"><a id="__codelineno-27-15" name="__codelineno-27-15" href="#__codelineno-27-15"></a><span class="cm">--&gt;</span>
</span><span id="__span-27-16"><a id="__codelineno-27-16" name="__codelineno-27-16" href="#__codelineno-27-16"></a>
</span><span id="__span-27-17"><a id="__codelineno-27-17" name="__codelineno-27-17" href="#__codelineno-27-17"></a><span class="cm">&lt;!-- Put site-specific property overrides in this file. --&gt;</span>
</span><span id="__span-27-18"><a id="__codelineno-27-18" name="__codelineno-27-18" href="#__codelineno-27-18"></a>
</span><span id="__span-27-19"><a id="__codelineno-27-19" name="__codelineno-27-19" href="#__codelineno-27-19"></a><span class="nt">&lt;configuration&gt;</span>
</span><span id="__span-27-20"><a id="__codelineno-27-20" name="__codelineno-27-20" href="#__codelineno-27-20"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-27-21"><a id="__codelineno-27-21" name="__codelineno-27-21" href="#__codelineno-27-21"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>fs.defaultFS<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-27-22"><a id="__codelineno-27-22" name="__codelineno-27-22" href="#__codelineno-27-22"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>hdfs://xuwangwei<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-27-23"><a id="__codelineno-27-23" name="__codelineno-27-23" href="#__codelineno-27-23"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-27-24"><a id="__codelineno-27-24" name="__codelineno-27-24" href="#__codelineno-27-24"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-27-25"><a id="__codelineno-27-25" name="__codelineno-27-25" href="#__codelineno-27-25"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>hadoop.tmp.dir<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-27-26"><a id="__codelineno-27-26" name="__codelineno-27-26" href="#__codelineno-27-26"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>/var/lib/hadoop<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-27-27"><a id="__codelineno-27-27" name="__codelineno-27-27" href="#__codelineno-27-27"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-27-28"><a id="__codelineno-27-28" name="__codelineno-27-28" href="#__codelineno-27-28"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-27-29"><a id="__codelineno-27-29" name="__codelineno-27-29" href="#__codelineno-27-29"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>hadoop.zk.address<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-27-30"><a id="__codelineno-27-30" name="__codelineno-27-30" href="#__codelineno-27-30"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>machine1.xuwangwei.test:2181,machine2.xuwangwei.test:2181,machine3.xuwangwei.test:2181,machine4.xuwangwei.test:2181,machine5.xuwangwei.test:2181<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-27-31"><a id="__codelineno-27-31" name="__codelineno-27-31" href="#__codelineno-27-31"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-27-32"><a id="__codelineno-27-32" name="__codelineno-27-32" href="#__codelineno-27-32"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-27-33"><a id="__codelineno-27-33" name="__codelineno-27-33" href="#__codelineno-27-33"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>ha.zookeeper.quorum<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-27-34"><a id="__codelineno-27-34" name="__codelineno-27-34" href="#__codelineno-27-34"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>machine1.xuwangwei.test:2181,machine2.xuwangwei.test:2181,machine3.xuwangwei.test:2181,machine4.xuwangwei.test:2181,machine5.xuwangwei.test:2181<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-27-35"><a id="__codelineno-27-35" name="__codelineno-27-35" href="#__codelineno-27-35"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-27-36"><a id="__codelineno-27-36" name="__codelineno-27-36" href="#__codelineno-27-36"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-27-37"><a id="__codelineno-27-37" name="__codelineno-27-37" href="#__codelineno-27-37"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>hadoop.security.authentication<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-27-38"><a id="__codelineno-27-38" name="__codelineno-27-38" href="#__codelineno-27-38"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>kerberos<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-27-39"><a id="__codelineno-27-39" name="__codelineno-27-39" href="#__codelineno-27-39"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-27-40"><a id="__codelineno-27-40" name="__codelineno-27-40" href="#__codelineno-27-40"></a><span class="nt">&lt;/configuration&gt;</span>
</span></code></pre></div>
</li>
<li>
<p>修改配置文件$HADOOP_CONF_DIR/hdfs-site.xml</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="cp">&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;configuration.xsl&quot;?&gt;</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="cm">&lt;!--</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="cm">Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="cm">you may not use this file except in compliance with the License.</span>
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="cm">You may obtain a copy of the License at</span>
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a>
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a><span class="cm">    http://www.apache.org/licenses/LICENSE-2.0</span>
</span><span id="__span-28-9"><a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a>
</span><span id="__span-28-10"><a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a><span class="cm">Unless required by applicable law or agreed to in writing, software</span>
</span><span id="__span-28-11"><a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a><span class="cm">distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
</span><span id="__span-28-12"><a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a><span class="cm">WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
</span><span id="__span-28-13"><a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a><span class="cm">See the License for the specific language governing permissions and</span>
</span><span id="__span-28-14"><a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a><span class="cm">limitations under the License. See accompanying LICENSE file.</span>
</span><span id="__span-28-15"><a id="__codelineno-28-15" name="__codelineno-28-15" href="#__codelineno-28-15"></a><span class="cm">--&gt;</span>
</span><span id="__span-28-16"><a id="__codelineno-28-16" name="__codelineno-28-16" href="#__codelineno-28-16"></a>
</span><span id="__span-28-17"><a id="__codelineno-28-17" name="__codelineno-28-17" href="#__codelineno-28-17"></a><span class="cm">&lt;!-- Put site-specific property overrides in this file. --&gt;</span>
</span><span id="__span-28-18"><a id="__codelineno-28-18" name="__codelineno-28-18" href="#__codelineno-28-18"></a>
</span><span id="__span-28-19"><a id="__codelineno-28-19" name="__codelineno-28-19" href="#__codelineno-28-19"></a><span class="nt">&lt;configuration&gt;</span>
</span><span id="__span-28-20"><a id="__codelineno-28-20" name="__codelineno-28-20" href="#__codelineno-28-20"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-28-21"><a id="__codelineno-28-21" name="__codelineno-28-21" href="#__codelineno-28-21"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>dfs.nameservices<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-28-22"><a id="__codelineno-28-22" name="__codelineno-28-22" href="#__codelineno-28-22"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>xuwangwei<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-28-23"><a id="__codelineno-28-23" name="__codelineno-28-23" href="#__codelineno-28-23"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-28-24"><a id="__codelineno-28-24" name="__codelineno-28-24" href="#__codelineno-28-24"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-28-25"><a id="__codelineno-28-25" name="__codelineno-28-25" href="#__codelineno-28-25"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>dfs.ha.namenodes.xuwangwei<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-28-26"><a id="__codelineno-28-26" name="__codelineno-28-26" href="#__codelineno-28-26"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>nn1,nn2,nn3<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-28-27"><a id="__codelineno-28-27" name="__codelineno-28-27" href="#__codelineno-28-27"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-28-28"><a id="__codelineno-28-28" name="__codelineno-28-28" href="#__codelineno-28-28"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-28-29"><a id="__codelineno-28-29" name="__codelineno-28-29" href="#__codelineno-28-29"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>dfs.namenode.rpc-address.xuwangwei.nn1<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-28-30"><a id="__codelineno-28-30" name="__codelineno-28-30" href="#__codelineno-28-30"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>machine1.xuwangwei.test:8020<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-28-31"><a id="__codelineno-28-31" name="__codelineno-28-31" href="#__codelineno-28-31"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-28-32"><a id="__codelineno-28-32" name="__codelineno-28-32" href="#__codelineno-28-32"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-28-33"><a id="__codelineno-28-33" name="__codelineno-28-33" href="#__codelineno-28-33"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>dfs.namenode.rpc-address.xuwangwei.nn2<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-28-34"><a id="__codelineno-28-34" name="__codelineno-28-34" href="#__codelineno-28-34"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>machine2.xuwangwei.test:8020<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-28-35"><a id="__codelineno-28-35" name="__codelineno-28-35" href="#__codelineno-28-35"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-28-36"><a id="__codelineno-28-36" name="__codelineno-28-36" href="#__codelineno-28-36"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-28-37"><a id="__codelineno-28-37" name="__codelineno-28-37" href="#__codelineno-28-37"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>dfs.namenode.rpc-address.xuwangwei.nn3<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-28-38"><a id="__codelineno-28-38" name="__codelineno-28-38" href="#__codelineno-28-38"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>machine3.xuwangwei.test:8020<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-28-39"><a id="__codelineno-28-39" name="__codelineno-28-39" href="#__codelineno-28-39"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-28-40"><a id="__codelineno-28-40" name="__codelineno-28-40" href="#__codelineno-28-40"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-28-41"><a id="__codelineno-28-41" name="__codelineno-28-41" href="#__codelineno-28-41"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>dfs.namenode.http-address.xuwangwei.nn1<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-28-42"><a id="__codelineno-28-42" name="__codelineno-28-42" href="#__codelineno-28-42"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>machine1.xuwangwei.test:9870<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-28-43"><a id="__codelineno-28-43" name="__codelineno-28-43" href="#__codelineno-28-43"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-28-44"><a id="__codelineno-28-44" name="__codelineno-28-44" href="#__codelineno-28-44"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-28-45"><a id="__codelineno-28-45" name="__codelineno-28-45" href="#__codelineno-28-45"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>dfs.namenode.http-address.xuwangwei.nn2<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-28-46"><a id="__codelineno-28-46" name="__codelineno-28-46" href="#__codelineno-28-46"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>machine2.xuwangwei.test:9870<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-28-47"><a id="__codelineno-28-47" name="__codelineno-28-47" href="#__codelineno-28-47"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-28-48"><a id="__codelineno-28-48" name="__codelineno-28-48" href="#__codelineno-28-48"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-28-49"><a id="__codelineno-28-49" name="__codelineno-28-49" href="#__codelineno-28-49"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>dfs.namenode.http-address.xuwangwei.nn3<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-28-50"><a id="__codelineno-28-50" name="__codelineno-28-50" href="#__codelineno-28-50"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>machine3.xuwangwei.test:9870<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-28-51"><a id="__codelineno-28-51" name="__codelineno-28-51" href="#__codelineno-28-51"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-28-52"><a id="__codelineno-28-52" name="__codelineno-28-52" href="#__codelineno-28-52"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-28-53"><a id="__codelineno-28-53" name="__codelineno-28-53" href="#__codelineno-28-53"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>dfs.client.failover.proxy.provider.xuwangwei<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-28-54"><a id="__codelineno-28-54" name="__codelineno-28-54" href="#__codelineno-28-54"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-28-55"><a id="__codelineno-28-55" name="__codelineno-28-55" href="#__codelineno-28-55"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-28-56"><a id="__codelineno-28-56" name="__codelineno-28-56" href="#__codelineno-28-56"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-28-57"><a id="__codelineno-28-57" name="__codelineno-28-57" href="#__codelineno-28-57"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>dfs.ha.fencing.methods<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-28-58"><a id="__codelineno-28-58" name="__codelineno-28-58" href="#__codelineno-28-58"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>sshfence<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-28-59"><a id="__codelineno-28-59" name="__codelineno-28-59" href="#__codelineno-28-59"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-28-60"><a id="__codelineno-28-60" name="__codelineno-28-60" href="#__codelineno-28-60"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-28-61"><a id="__codelineno-28-61" name="__codelineno-28-61" href="#__codelineno-28-61"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>dfs.ha.fencing.ssh.private-key-files<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-28-62"><a id="__codelineno-28-62" name="__codelineno-28-62" href="#__codelineno-28-62"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>/home/hdfs/.ssh/id_rsa<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-28-63"><a id="__codelineno-28-63" name="__codelineno-28-63" href="#__codelineno-28-63"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-28-64"><a id="__codelineno-28-64" name="__codelineno-28-64" href="#__codelineno-28-64"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-28-65"><a id="__codelineno-28-65" name="__codelineno-28-65" href="#__codelineno-28-65"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>dfs.namenode.shared.edits.dir<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-28-66"><a id="__codelineno-28-66" name="__codelineno-28-66" href="#__codelineno-28-66"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>qjournal://machine1.xuwangwei.test:8485;machine2.xuwangwei.test:8485;machine3.xuwangwei.test:8485/xuwangwei<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-28-67"><a id="__codelineno-28-67" name="__codelineno-28-67" href="#__codelineno-28-67"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-28-68"><a id="__codelineno-28-68" name="__codelineno-28-68" href="#__codelineno-28-68"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-28-69"><a id="__codelineno-28-69" name="__codelineno-28-69" href="#__codelineno-28-69"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>dfs.journalnode.edits.dir<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-28-70"><a id="__codelineno-28-70" name="__codelineno-28-70" href="#__codelineno-28-70"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>${hadoop.tmp.dir}/dfs/journalnode/<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-28-71"><a id="__codelineno-28-71" name="__codelineno-28-71" href="#__codelineno-28-71"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-28-72"><a id="__codelineno-28-72" name="__codelineno-28-72" href="#__codelineno-28-72"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-28-73"><a id="__codelineno-28-73" name="__codelineno-28-73" href="#__codelineno-28-73"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>dfs.ha.nn.not-become-active-in-safemode<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-28-74"><a id="__codelineno-28-74" name="__codelineno-28-74" href="#__codelineno-28-74"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>true<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-28-75"><a id="__codelineno-28-75" name="__codelineno-28-75" href="#__codelineno-28-75"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-28-76"><a id="__codelineno-28-76" name="__codelineno-28-76" href="#__codelineno-28-76"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-28-77"><a id="__codelineno-28-77" name="__codelineno-28-77" href="#__codelineno-28-77"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>dfs.ha.automatic-failover.enabled<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-28-78"><a id="__codelineno-28-78" name="__codelineno-28-78" href="#__codelineno-28-78"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>true<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-28-79"><a id="__codelineno-28-79" name="__codelineno-28-79" href="#__codelineno-28-79"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-28-80"><a id="__codelineno-28-80" name="__codelineno-28-80" href="#__codelineno-28-80"></a><span class="cm">&lt;!-- start for kerberos --&gt;</span>
</span><span id="__span-28-81"><a id="__codelineno-28-81" name="__codelineno-28-81" href="#__codelineno-28-81"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-28-82"><a id="__codelineno-28-82" name="__codelineno-28-82" href="#__codelineno-28-82"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>dfs.block.access.token.enable<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-28-83"><a id="__codelineno-28-83" name="__codelineno-28-83" href="#__codelineno-28-83"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>true<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-28-84"><a id="__codelineno-28-84" name="__codelineno-28-84" href="#__codelineno-28-84"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-28-85"><a id="__codelineno-28-85" name="__codelineno-28-85" href="#__codelineno-28-85"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-28-86"><a id="__codelineno-28-86" name="__codelineno-28-86" href="#__codelineno-28-86"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>dfs.namenode.keytab.file<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-28-87"><a id="__codelineno-28-87" name="__codelineno-28-87" href="#__codelineno-28-87"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>/etc/hadoop/hdfs.keytab<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-28-88"><a id="__codelineno-28-88" name="__codelineno-28-88" href="#__codelineno-28-88"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-28-89"><a id="__codelineno-28-89" name="__codelineno-28-89" href="#__codelineno-28-89"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-28-90"><a id="__codelineno-28-90" name="__codelineno-28-90" href="#__codelineno-28-90"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>dfs.namenode.kerberos.principal<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-28-91"><a id="__codelineno-28-91" name="__codelineno-28-91" href="#__codelineno-28-91"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>hdfs/_HOST@XUWANGWEI.TEST<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-28-92"><a id="__codelineno-28-92" name="__codelineno-28-92" href="#__codelineno-28-92"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-28-93"><a id="__codelineno-28-93" name="__codelineno-28-93" href="#__codelineno-28-93"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-28-94"><a id="__codelineno-28-94" name="__codelineno-28-94" href="#__codelineno-28-94"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>dfs.namenode.kerberos.internal.spnego.principal<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-28-95"><a id="__codelineno-28-95" name="__codelineno-28-95" href="#__codelineno-28-95"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>HTTP/_HOST@XUWANGWEI.TEST<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-28-96"><a id="__codelineno-28-96" name="__codelineno-28-96" href="#__codelineno-28-96"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-28-97"><a id="__codelineno-28-97" name="__codelineno-28-97" href="#__codelineno-28-97"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-28-98"><a id="__codelineno-28-98" name="__codelineno-28-98" href="#__codelineno-28-98"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>dfs.journalnode.keytab.file<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-28-99"><a id="__codelineno-28-99" name="__codelineno-28-99" href="#__codelineno-28-99"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>/etc/hadoop/hdfs.keytab<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-28-100"><a id="__codelineno-28-100" name="__codelineno-28-100" href="#__codelineno-28-100"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-28-101"><a id="__codelineno-28-101" name="__codelineno-28-101" href="#__codelineno-28-101"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-28-102"><a id="__codelineno-28-102" name="__codelineno-28-102" href="#__codelineno-28-102"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>dfs.journalnode.kerberos.principal<span class="w"> </span><span class="nt">&lt;/name&gt;</span>
</span><span id="__span-28-103"><a id="__codelineno-28-103" name="__codelineno-28-103" href="#__codelineno-28-103"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>hdfs/_HOST@XUWANGWEI.TEST<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-28-104"><a id="__codelineno-28-104" name="__codelineno-28-104" href="#__codelineno-28-104"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-28-105"><a id="__codelineno-28-105" name="__codelineno-28-105" href="#__codelineno-28-105"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-28-106"><a id="__codelineno-28-106" name="__codelineno-28-106" href="#__codelineno-28-106"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>dfs.journalnode.kerberos.internal.spnego.principal<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-28-107"><a id="__codelineno-28-107" name="__codelineno-28-107" href="#__codelineno-28-107"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>HTTP/_HOST@XUWANGWEI.TEST<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-28-108"><a id="__codelineno-28-108" name="__codelineno-28-108" href="#__codelineno-28-108"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-28-109"><a id="__codelineno-28-109" name="__codelineno-28-109" href="#__codelineno-28-109"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-28-110"><a id="__codelineno-28-110" name="__codelineno-28-110" href="#__codelineno-28-110"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>dfs.data.transfer.protection<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-28-111"><a id="__codelineno-28-111" name="__codelineno-28-111" href="#__codelineno-28-111"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>authentication<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-28-112"><a id="__codelineno-28-112" name="__codelineno-28-112" href="#__codelineno-28-112"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-28-113"><a id="__codelineno-28-113" name="__codelineno-28-113" href="#__codelineno-28-113"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-28-114"><a id="__codelineno-28-114" name="__codelineno-28-114" href="#__codelineno-28-114"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>dfs.http.policy<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-28-115"><a id="__codelineno-28-115" name="__codelineno-28-115" href="#__codelineno-28-115"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>HTTPS_ONLY<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-28-116"><a id="__codelineno-28-116" name="__codelineno-28-116" href="#__codelineno-28-116"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-28-117"><a id="__codelineno-28-117" name="__codelineno-28-117" href="#__codelineno-28-117"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-28-118"><a id="__codelineno-28-118" name="__codelineno-28-118" href="#__codelineno-28-118"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>dfs.datanode.keytab.file<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-28-119"><a id="__codelineno-28-119" name="__codelineno-28-119" href="#__codelineno-28-119"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>/etc/hadoop/hdfs.keytab<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-28-120"><a id="__codelineno-28-120" name="__codelineno-28-120" href="#__codelineno-28-120"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-28-121"><a id="__codelineno-28-121" name="__codelineno-28-121" href="#__codelineno-28-121"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-28-122"><a id="__codelineno-28-122" name="__codelineno-28-122" href="#__codelineno-28-122"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>dfs.datanode.kerberos.principal<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-28-123"><a id="__codelineno-28-123" name="__codelineno-28-123" href="#__codelineno-28-123"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>hdfs/_HOST@XUWANGWEI.TEST<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-28-124"><a id="__codelineno-28-124" name="__codelineno-28-124" href="#__codelineno-28-124"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-28-125"><a id="__codelineno-28-125" name="__codelineno-28-125" href="#__codelineno-28-125"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-28-126"><a id="__codelineno-28-126" name="__codelineno-28-126" href="#__codelineno-28-126"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>dfs.web.authentication.kerberos.keytab<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-28-127"><a id="__codelineno-28-127" name="__codelineno-28-127" href="#__codelineno-28-127"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>/etc/hadoop/hdfs.keytab<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-28-128"><a id="__codelineno-28-128" name="__codelineno-28-128" href="#__codelineno-28-128"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-28-129"><a id="__codelineno-28-129" name="__codelineno-28-129" href="#__codelineno-28-129"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-28-130"><a id="__codelineno-28-130" name="__codelineno-28-130" href="#__codelineno-28-130"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>dfs.web.authentication.kerberos.principal<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-28-131"><a id="__codelineno-28-131" name="__codelineno-28-131" href="#__codelineno-28-131"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>HTTP/_HOST@XUWANGWEI.TEST<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-28-132"><a id="__codelineno-28-132" name="__codelineno-28-132" href="#__codelineno-28-132"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-28-133"><a id="__codelineno-28-133" name="__codelineno-28-133" href="#__codelineno-28-133"></a><span class="cm">&lt;!-- end for kerberos --&gt;</span>
</span><span id="__span-28-134"><a id="__codelineno-28-134" name="__codelineno-28-134" href="#__codelineno-28-134"></a><span class="nt">&lt;/configuration&gt;</span>
</span></code></pre></div>
</li>
<li>
<p>修改配置文件$HADOOP_CONF_DIR/yarn-site.xml</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="cm">&lt;!--</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="cm">Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="cm">you may not use this file except in compliance with the License.</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="cm">You may obtain a copy of the License at</span>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="cm">    http://www.apache.org/licenses/LICENSE-2.0</span>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a><span class="cm">Unless required by applicable law or agreed to in writing, software</span>
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a><span class="cm">distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
</span><span id="__span-29-11"><a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a><span class="cm">WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
</span><span id="__span-29-12"><a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a><span class="cm">See the License for the specific language governing permissions and</span>
</span><span id="__span-29-13"><a id="__codelineno-29-13" name="__codelineno-29-13" href="#__codelineno-29-13"></a><span class="cm">limitations under the License. See accompanying LICENSE file.</span>
</span><span id="__span-29-14"><a id="__codelineno-29-14" name="__codelineno-29-14" href="#__codelineno-29-14"></a><span class="cm">--&gt;</span>
</span><span id="__span-29-15"><a id="__codelineno-29-15" name="__codelineno-29-15" href="#__codelineno-29-15"></a><span class="nt">&lt;configuration&gt;</span>
</span><span id="__span-29-16"><a id="__codelineno-29-16" name="__codelineno-29-16" href="#__codelineno-29-16"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-29-17"><a id="__codelineno-29-17" name="__codelineno-29-17" href="#__codelineno-29-17"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>yarn.nodemanager.aux-services<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-29-18"><a id="__codelineno-29-18" name="__codelineno-29-18" href="#__codelineno-29-18"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>mapreduce_shuffle<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-29-19"><a id="__codelineno-29-19" name="__codelineno-29-19" href="#__codelineno-29-19"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-29-20"><a id="__codelineno-29-20" name="__codelineno-29-20" href="#__codelineno-29-20"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-29-21"><a id="__codelineno-29-21" name="__codelineno-29-21" href="#__codelineno-29-21"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>yarn.nodemanager.env-whitelist<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-29-22"><a id="__codelineno-29-22" name="__codelineno-29-22" href="#__codelineno-29-22"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>JAVA_HOME,HADOOP_COMMON_HOME,HADOOP_HDFS_HOME,HADOOP_CONF_DIR,CLASSPATH_PREPEND_DISTCACHE,HADOOP_YARN_HOME,HADOOP_HOME,PATH,LANG,TZ,HADOOP_MAPRED_HOME<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-29-23"><a id="__codelineno-29-23" name="__codelineno-29-23" href="#__codelineno-29-23"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-29-24"><a id="__codelineno-29-24" name="__codelineno-29-24" href="#__codelineno-29-24"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-29-25"><a id="__codelineno-29-25" name="__codelineno-29-25" href="#__codelineno-29-25"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>yarn.resourcemanager.ha.enabled<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-29-26"><a id="__codelineno-29-26" name="__codelineno-29-26" href="#__codelineno-29-26"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>true<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-29-27"><a id="__codelineno-29-27" name="__codelineno-29-27" href="#__codelineno-29-27"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-29-28"><a id="__codelineno-29-28" name="__codelineno-29-28" href="#__codelineno-29-28"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-29-29"><a id="__codelineno-29-29" name="__codelineno-29-29" href="#__codelineno-29-29"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>yarn.resourcemanager.cluster-id<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-29-30"><a id="__codelineno-29-30" name="__codelineno-29-30" href="#__codelineno-29-30"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>xuwangwei<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-29-31"><a id="__codelineno-29-31" name="__codelineno-29-31" href="#__codelineno-29-31"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-29-32"><a id="__codelineno-29-32" name="__codelineno-29-32" href="#__codelineno-29-32"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-29-33"><a id="__codelineno-29-33" name="__codelineno-29-33" href="#__codelineno-29-33"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>yarn.resourcemanager.ha.rm-ids<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-29-34"><a id="__codelineno-29-34" name="__codelineno-29-34" href="#__codelineno-29-34"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>rm1,rm2<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-29-35"><a id="__codelineno-29-35" name="__codelineno-29-35" href="#__codelineno-29-35"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-29-36"><a id="__codelineno-29-36" name="__codelineno-29-36" href="#__codelineno-29-36"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-29-37"><a id="__codelineno-29-37" name="__codelineno-29-37" href="#__codelineno-29-37"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>yarn.resourcemanager.hostname.rm1<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-29-38"><a id="__codelineno-29-38" name="__codelineno-29-38" href="#__codelineno-29-38"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>machine4.xuwangwei.test<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-29-39"><a id="__codelineno-29-39" name="__codelineno-29-39" href="#__codelineno-29-39"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-29-40"><a id="__codelineno-29-40" name="__codelineno-29-40" href="#__codelineno-29-40"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-29-41"><a id="__codelineno-29-41" name="__codelineno-29-41" href="#__codelineno-29-41"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>yarn.resourcemanager.hostname.rm2<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-29-42"><a id="__codelineno-29-42" name="__codelineno-29-42" href="#__codelineno-29-42"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>machine5.xuwangwei.test<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-29-43"><a id="__codelineno-29-43" name="__codelineno-29-43" href="#__codelineno-29-43"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-29-44"><a id="__codelineno-29-44" name="__codelineno-29-44" href="#__codelineno-29-44"></a><span class="cm">&lt;!-- start for kerberos --&gt;</span>
</span><span id="__span-29-45"><a id="__codelineno-29-45" name="__codelineno-29-45" href="#__codelineno-29-45"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-29-46"><a id="__codelineno-29-46" name="__codelineno-29-46" href="#__codelineno-29-46"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>yarn.resourcemanager.principal<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-29-47"><a id="__codelineno-29-47" name="__codelineno-29-47" href="#__codelineno-29-47"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>yarn/_HOST@XUWANGWEI.TEST<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-29-48"><a id="__codelineno-29-48" name="__codelineno-29-48" href="#__codelineno-29-48"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-29-49"><a id="__codelineno-29-49" name="__codelineno-29-49" href="#__codelineno-29-49"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-29-50"><a id="__codelineno-29-50" name="__codelineno-29-50" href="#__codelineno-29-50"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>yarn.resourcemanager.webapp.spnego-principal<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-29-51"><a id="__codelineno-29-51" name="__codelineno-29-51" href="#__codelineno-29-51"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>HTTP/_HOST@XUWANGWEI.TEST<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-29-52"><a id="__codelineno-29-52" name="__codelineno-29-52" href="#__codelineno-29-52"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-29-53"><a id="__codelineno-29-53" name="__codelineno-29-53" href="#__codelineno-29-53"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-29-54"><a id="__codelineno-29-54" name="__codelineno-29-54" href="#__codelineno-29-54"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>yarn.resourcemanager.keytab<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-29-55"><a id="__codelineno-29-55" name="__codelineno-29-55" href="#__codelineno-29-55"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>/etc/hadoop/yarn.keytab<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-29-56"><a id="__codelineno-29-56" name="__codelineno-29-56" href="#__codelineno-29-56"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-29-57"><a id="__codelineno-29-57" name="__codelineno-29-57" href="#__codelineno-29-57"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-29-58"><a id="__codelineno-29-58" name="__codelineno-29-58" href="#__codelineno-29-58"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>yarn.resourcemanager.webapp.spnego-keytab-file<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-29-59"><a id="__codelineno-29-59" name="__codelineno-29-59" href="#__codelineno-29-59"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>/etc/hadoop/yarn.keytab<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-29-60"><a id="__codelineno-29-60" name="__codelineno-29-60" href="#__codelineno-29-60"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-29-61"><a id="__codelineno-29-61" name="__codelineno-29-61" href="#__codelineno-29-61"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-29-62"><a id="__codelineno-29-62" name="__codelineno-29-62" href="#__codelineno-29-62"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>yarn.nodemanager.principal<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-29-63"><a id="__codelineno-29-63" name="__codelineno-29-63" href="#__codelineno-29-63"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>yarn/_HOST@XUWANGWEI.TEST<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-29-64"><a id="__codelineno-29-64" name="__codelineno-29-64" href="#__codelineno-29-64"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-29-65"><a id="__codelineno-29-65" name="__codelineno-29-65" href="#__codelineno-29-65"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-29-66"><a id="__codelineno-29-66" name="__codelineno-29-66" href="#__codelineno-29-66"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>yarn.nodemanager.webapp.spnego-principal<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-29-67"><a id="__codelineno-29-67" name="__codelineno-29-67" href="#__codelineno-29-67"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>HTTP/_HOST@XUWANGWEI.TEST<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-29-68"><a id="__codelineno-29-68" name="__codelineno-29-68" href="#__codelineno-29-68"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-29-69"><a id="__codelineno-29-69" name="__codelineno-29-69" href="#__codelineno-29-69"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-29-70"><a id="__codelineno-29-70" name="__codelineno-29-70" href="#__codelineno-29-70"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>yarn.nodemanager.keytab<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-29-71"><a id="__codelineno-29-71" name="__codelineno-29-71" href="#__codelineno-29-71"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>/etc/hadoop/yarn.keytab<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-29-72"><a id="__codelineno-29-72" name="__codelineno-29-72" href="#__codelineno-29-72"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-29-73"><a id="__codelineno-29-73" name="__codelineno-29-73" href="#__codelineno-29-73"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-29-74"><a id="__codelineno-29-74" name="__codelineno-29-74" href="#__codelineno-29-74"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>yarn.nodemanager.webapp.spnego-keytab-file<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-29-75"><a id="__codelineno-29-75" name="__codelineno-29-75" href="#__codelineno-29-75"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>/etc/hadoop/yarn.keytab<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-29-76"><a id="__codelineno-29-76" name="__codelineno-29-76" href="#__codelineno-29-76"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-29-77"><a id="__codelineno-29-77" name="__codelineno-29-77" href="#__codelineno-29-77"></a><span class="cm">&lt;!-- end for kerberos --&gt;</span>
</span><span id="__span-29-78"><a id="__codelineno-29-78" name="__codelineno-29-78" href="#__codelineno-29-78"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-29-79"><a id="__codelineno-29-79" name="__codelineno-29-79" href="#__codelineno-29-79"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>yarn.nodemanager.container-executor.class<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-29-80"><a id="__codelineno-29-80" name="__codelineno-29-80" href="#__codelineno-29-80"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>org.apache.hadoop.yarn.server.nodemanager.LinuxContainerExecutor<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-29-81"><a id="__codelineno-29-81" name="__codelineno-29-81" href="#__codelineno-29-81"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-29-82"><a id="__codelineno-29-82" name="__codelineno-29-82" href="#__codelineno-29-82"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-29-83"><a id="__codelineno-29-83" name="__codelineno-29-83" href="#__codelineno-29-83"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>yarn.nodemanager.linux-container-executor.group<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-29-84"><a id="__codelineno-29-84" name="__codelineno-29-84" href="#__codelineno-29-84"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>hadoop<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-29-85"><a id="__codelineno-29-85" name="__codelineno-29-85" href="#__codelineno-29-85"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-29-86"><a id="__codelineno-29-86" name="__codelineno-29-86" href="#__codelineno-29-86"></a><span class="nt">&lt;/configuration&gt;</span>
</span></code></pre></div>
</li>
<li>
<p>修改配置文件$HADOOP_CONF_DIR/container-executor.cfg</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>yarn.nodemanager.linux-container-executor.group=hadoop
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>banned.users=root
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>#allowed.system.users=
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>min.user.id=1000
</span></code></pre></div>
</li>
<li>
<p>修改配置文件$HADOOP_CONF_DIR/mapred-site.xml</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="cp">&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;configuration.xsl&quot;?&gt;</span>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="cm">&lt;!--</span>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="cm">Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="cm">you may not use this file except in compliance with the License.</span>
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="cm">You may obtain a copy of the License at</span>
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a>
</span><span id="__span-31-8"><a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a><span class="cm">    http://www.apache.org/licenses/LICENSE-2.0</span>
</span><span id="__span-31-9"><a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a>
</span><span id="__span-31-10"><a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a><span class="cm">Unless required by applicable law or agreed to in writing, software</span>
</span><span id="__span-31-11"><a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a><span class="cm">distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
</span><span id="__span-31-12"><a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a><span class="cm">WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
</span><span id="__span-31-13"><a id="__codelineno-31-13" name="__codelineno-31-13" href="#__codelineno-31-13"></a><span class="cm">See the License for the specific language governing permissions and</span>
</span><span id="__span-31-14"><a id="__codelineno-31-14" name="__codelineno-31-14" href="#__codelineno-31-14"></a><span class="cm">limitations under the License. See accompanying LICENSE file.</span>
</span><span id="__span-31-15"><a id="__codelineno-31-15" name="__codelineno-31-15" href="#__codelineno-31-15"></a><span class="cm">--&gt;</span>
</span><span id="__span-31-16"><a id="__codelineno-31-16" name="__codelineno-31-16" href="#__codelineno-31-16"></a>
</span><span id="__span-31-17"><a id="__codelineno-31-17" name="__codelineno-31-17" href="#__codelineno-31-17"></a><span class="cm">&lt;!-- Put site-specific property overrides in this file. --&gt;</span>
</span><span id="__span-31-18"><a id="__codelineno-31-18" name="__codelineno-31-18" href="#__codelineno-31-18"></a>
</span><span id="__span-31-19"><a id="__codelineno-31-19" name="__codelineno-31-19" href="#__codelineno-31-19"></a><span class="nt">&lt;configuration&gt;</span>
</span><span id="__span-31-20"><a id="__codelineno-31-20" name="__codelineno-31-20" href="#__codelineno-31-20"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-31-21"><a id="__codelineno-31-21" name="__codelineno-31-21" href="#__codelineno-31-21"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>mapreduce.framework.name<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-31-22"><a id="__codelineno-31-22" name="__codelineno-31-22" href="#__codelineno-31-22"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>yarn<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-31-23"><a id="__codelineno-31-23" name="__codelineno-31-23" href="#__codelineno-31-23"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-31-24"><a id="__codelineno-31-24" name="__codelineno-31-24" href="#__codelineno-31-24"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-31-25"><a id="__codelineno-31-25" name="__codelineno-31-25" href="#__codelineno-31-25"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>mapreduce.jobhistory.address<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-31-26"><a id="__codelineno-31-26" name="__codelineno-31-26" href="#__codelineno-31-26"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>machine1.xuwangwei.test:10020<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-31-27"><a id="__codelineno-31-27" name="__codelineno-31-27" href="#__codelineno-31-27"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-31-28"><a id="__codelineno-31-28" name="__codelineno-31-28" href="#__codelineno-31-28"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-31-29"><a id="__codelineno-31-29" name="__codelineno-31-29" href="#__codelineno-31-29"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>mapreduce.jobhistory.webapp.address<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-31-30"><a id="__codelineno-31-30" name="__codelineno-31-30" href="#__codelineno-31-30"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>machine1.xuwangwei.test:19888<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-31-31"><a id="__codelineno-31-31" name="__codelineno-31-31" href="#__codelineno-31-31"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-31-32"><a id="__codelineno-31-32" name="__codelineno-31-32" href="#__codelineno-31-32"></a><span class="cm">&lt;!-- start for kerberos --&gt;</span>
</span><span id="__span-31-33"><a id="__codelineno-31-33" name="__codelineno-31-33" href="#__codelineno-31-33"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-31-34"><a id="__codelineno-31-34" name="__codelineno-31-34" href="#__codelineno-31-34"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>mapreduce.jobhistory.principal<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-31-35"><a id="__codelineno-31-35" name="__codelineno-31-35" href="#__codelineno-31-35"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>mapred/_HOST@XUWANGWEI.TEST<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-31-36"><a id="__codelineno-31-36" name="__codelineno-31-36" href="#__codelineno-31-36"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-31-37"><a id="__codelineno-31-37" name="__codelineno-31-37" href="#__codelineno-31-37"></a><span class="nt">&lt;property&gt;</span>
</span><span id="__span-31-38"><a id="__codelineno-31-38" name="__codelineno-31-38" href="#__codelineno-31-38"></a><span class="w">    </span><span class="nt">&lt;name&gt;</span>mapreduce.jobhistory.keytab<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-31-39"><a id="__codelineno-31-39" name="__codelineno-31-39" href="#__codelineno-31-39"></a><span class="w">    </span><span class="nt">&lt;value&gt;</span>/etc/hadoop/mapred.keytab<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-31-40"><a id="__codelineno-31-40" name="__codelineno-31-40" href="#__codelineno-31-40"></a><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-31-41"><a id="__codelineno-31-41" name="__codelineno-31-41" href="#__codelineno-31-41"></a><span class="cm">&lt;!-- end for kerberos --&gt;</span>
</span><span id="__span-31-42"><a id="__codelineno-31-42" name="__codelineno-31-42" href="#__codelineno-31-42"></a><span class="nt">&lt;/configuration&gt;</span>
</span></code></pre></div>
</li>
<li>
<p>修改配置文件$HADOOP_CONF_DIR/workers</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>machine1
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>machine2
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a>machine3
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a>machine4
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a>machine5
</span></code></pre></div>
</li>
<li>
<p>创建配置文件 ssl-client.xml</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="cp">&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;configuration.xsl&quot;?&gt;</span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="cm">&lt;!--</span>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="cm">Licensed to the Apache Software Foundation (ASF) under one or more</span>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a><span class="cm">contributor license agreements.  See the NOTICE file distributed with</span>
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a><span class="cm">this work for additional information regarding copyright ownership.</span>
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a><span class="cm">The ASF licenses this file to You under the Apache License, Version 2.0</span>
</span><span id="__span-33-8"><a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a><span class="cm">(the &quot;License&quot;); you may not use this file except in compliance with</span>
</span><span id="__span-33-9"><a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a><span class="cm">the License.  You may obtain a copy of the License at</span>
</span><span id="__span-33-10"><a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a>
</span><span id="__span-33-11"><a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a><span class="cm">    http://www.apache.org/licenses/LICENSE-2.0</span>
</span><span id="__span-33-12"><a id="__codelineno-33-12" name="__codelineno-33-12" href="#__codelineno-33-12"></a>
</span><span id="__span-33-13"><a id="__codelineno-33-13" name="__codelineno-33-13" href="#__codelineno-33-13"></a><span class="cm">Unless required by applicable law or agreed to in writing, software</span>
</span><span id="__span-33-14"><a id="__codelineno-33-14" name="__codelineno-33-14" href="#__codelineno-33-14"></a><span class="cm">distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
</span><span id="__span-33-15"><a id="__codelineno-33-15" name="__codelineno-33-15" href="#__codelineno-33-15"></a><span class="cm">WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
</span><span id="__span-33-16"><a id="__codelineno-33-16" name="__codelineno-33-16" href="#__codelineno-33-16"></a><span class="cm">See the License for the specific language governing permissions and</span>
</span><span id="__span-33-17"><a id="__codelineno-33-17" name="__codelineno-33-17" href="#__codelineno-33-17"></a><span class="cm">limitations under the License.</span>
</span><span id="__span-33-18"><a id="__codelineno-33-18" name="__codelineno-33-18" href="#__codelineno-33-18"></a><span class="cm">--&gt;</span>
</span><span id="__span-33-19"><a id="__codelineno-33-19" name="__codelineno-33-19" href="#__codelineno-33-19"></a><span class="nt">&lt;configuration&gt;</span>
</span><span id="__span-33-20"><a id="__codelineno-33-20" name="__codelineno-33-20" href="#__codelineno-33-20"></a>
</span><span id="__span-33-21"><a id="__codelineno-33-21" name="__codelineno-33-21" href="#__codelineno-33-21"></a><span class="w">    </span><span class="nt">&lt;property&gt;</span>
</span><span id="__span-33-22"><a id="__codelineno-33-22" name="__codelineno-33-22" href="#__codelineno-33-22"></a><span class="w">        </span><span class="nt">&lt;name&gt;</span>ssl.client.truststore.location<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-33-23"><a id="__codelineno-33-23" name="__codelineno-33-23" href="#__codelineno-33-23"></a><span class="w">        </span><span class="nt">&lt;value&gt;</span>/etc/hadoop/hadoop.p12<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-33-24"><a id="__codelineno-33-24" name="__codelineno-33-24" href="#__codelineno-33-24"></a><span class="w">        </span><span class="nt">&lt;description&gt;</span>Truststore<span class="w"> </span>to<span class="w"> </span>be<span class="w"> </span>used<span class="w"> </span>by<span class="w"> </span>clients<span class="w"> </span>like<span class="w"> </span>distcp.<span class="w"> </span>Must<span class="w"> </span>be
</span><span id="__span-33-25"><a id="__codelineno-33-25" name="__codelineno-33-25" href="#__codelineno-33-25"></a><span class="w">            </span>specified.
</span><span id="__span-33-26"><a id="__codelineno-33-26" name="__codelineno-33-26" href="#__codelineno-33-26"></a><span class="w">        </span><span class="nt">&lt;/description&gt;</span>
</span><span id="__span-33-27"><a id="__codelineno-33-27" name="__codelineno-33-27" href="#__codelineno-33-27"></a><span class="w">    </span><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-33-28"><a id="__codelineno-33-28" name="__codelineno-33-28" href="#__codelineno-33-28"></a>
</span><span id="__span-33-29"><a id="__codelineno-33-29" name="__codelineno-33-29" href="#__codelineno-33-29"></a><span class="w">    </span><span class="nt">&lt;property&gt;</span>
</span><span id="__span-33-30"><a id="__codelineno-33-30" name="__codelineno-33-30" href="#__codelineno-33-30"></a><span class="w">        </span><span class="nt">&lt;name&gt;</span>ssl.client.truststore.password<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-33-31"><a id="__codelineno-33-31" name="__codelineno-33-31" href="#__codelineno-33-31"></a><span class="w">        </span><span class="nt">&lt;value&gt;</span>xuwangwei3306<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-33-32"><a id="__codelineno-33-32" name="__codelineno-33-32" href="#__codelineno-33-32"></a><span class="w">        </span><span class="nt">&lt;description&gt;</span>Optional.<span class="w"> </span>Default<span class="w"> </span>value<span class="w"> </span>is<span class="w"> </span>&quot;&quot;.
</span><span id="__span-33-33"><a id="__codelineno-33-33" name="__codelineno-33-33" href="#__codelineno-33-33"></a><span class="w">        </span><span class="nt">&lt;/description&gt;</span>
</span><span id="__span-33-34"><a id="__codelineno-33-34" name="__codelineno-33-34" href="#__codelineno-33-34"></a><span class="w">    </span><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-33-35"><a id="__codelineno-33-35" name="__codelineno-33-35" href="#__codelineno-33-35"></a>
</span><span id="__span-33-36"><a id="__codelineno-33-36" name="__codelineno-33-36" href="#__codelineno-33-36"></a><span class="w">    </span><span class="nt">&lt;property&gt;</span>
</span><span id="__span-33-37"><a id="__codelineno-33-37" name="__codelineno-33-37" href="#__codelineno-33-37"></a><span class="w">        </span><span class="nt">&lt;name&gt;</span>ssl.client.truststore.type<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-33-38"><a id="__codelineno-33-38" name="__codelineno-33-38" href="#__codelineno-33-38"></a><span class="w">        </span><span class="nt">&lt;value&gt;</span>pkcs12<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-33-39"><a id="__codelineno-33-39" name="__codelineno-33-39" href="#__codelineno-33-39"></a><span class="w">        </span><span class="nt">&lt;description&gt;</span>Optional.<span class="w"> </span>The<span class="w"> </span>keystore<span class="w"> </span>file<span class="w"> </span>format,<span class="w"> </span>default<span class="w"> </span>value<span class="w"> </span>is<span class="w"> </span>&quot;jks&quot;.
</span><span id="__span-33-40"><a id="__codelineno-33-40" name="__codelineno-33-40" href="#__codelineno-33-40"></a><span class="w">        </span><span class="nt">&lt;/description&gt;</span>
</span><span id="__span-33-41"><a id="__codelineno-33-41" name="__codelineno-33-41" href="#__codelineno-33-41"></a><span class="w">    </span><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-33-42"><a id="__codelineno-33-42" name="__codelineno-33-42" href="#__codelineno-33-42"></a>
</span><span id="__span-33-43"><a id="__codelineno-33-43" name="__codelineno-33-43" href="#__codelineno-33-43"></a><span class="w">    </span><span class="nt">&lt;property&gt;</span>
</span><span id="__span-33-44"><a id="__codelineno-33-44" name="__codelineno-33-44" href="#__codelineno-33-44"></a><span class="w">        </span><span class="nt">&lt;name&gt;</span>ssl.client.truststore.reload.interval<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-33-45"><a id="__codelineno-33-45" name="__codelineno-33-45" href="#__codelineno-33-45"></a><span class="w">        </span><span class="nt">&lt;value&gt;</span>10000<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-33-46"><a id="__codelineno-33-46" name="__codelineno-33-46" href="#__codelineno-33-46"></a><span class="w">        </span><span class="nt">&lt;description&gt;</span>Truststore<span class="w"> </span>reload<span class="w"> </span>check<span class="w"> </span>interval,<span class="w"> </span>in<span class="w"> </span>milliseconds.
</span><span id="__span-33-47"><a id="__codelineno-33-47" name="__codelineno-33-47" href="#__codelineno-33-47"></a><span class="w">            </span>Default<span class="w"> </span>value<span class="w"> </span>is<span class="w"> </span>10000<span class="w"> </span>(10<span class="w"> </span>seconds).
</span><span id="__span-33-48"><a id="__codelineno-33-48" name="__codelineno-33-48" href="#__codelineno-33-48"></a><span class="w">        </span><span class="nt">&lt;/description&gt;</span>
</span><span id="__span-33-49"><a id="__codelineno-33-49" name="__codelineno-33-49" href="#__codelineno-33-49"></a><span class="w">    </span><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-33-50"><a id="__codelineno-33-50" name="__codelineno-33-50" href="#__codelineno-33-50"></a>
</span><span id="__span-33-51"><a id="__codelineno-33-51" name="__codelineno-33-51" href="#__codelineno-33-51"></a><span class="w">    </span><span class="nt">&lt;property&gt;</span>
</span><span id="__span-33-52"><a id="__codelineno-33-52" name="__codelineno-33-52" href="#__codelineno-33-52"></a><span class="w">        </span><span class="nt">&lt;name&gt;</span>ssl.client.keystore.location<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-33-53"><a id="__codelineno-33-53" name="__codelineno-33-53" href="#__codelineno-33-53"></a><span class="w">        </span><span class="nt">&lt;value&gt;</span>/etc/hadoop/hadoop.p12<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-33-54"><a id="__codelineno-33-54" name="__codelineno-33-54" href="#__codelineno-33-54"></a><span class="w">        </span><span class="nt">&lt;description&gt;</span>Keystore<span class="w"> </span>to<span class="w"> </span>be<span class="w"> </span>used<span class="w"> </span>by<span class="w"> </span>clients<span class="w"> </span>like<span class="w"> </span>distcp.<span class="w"> </span>Must<span class="w"> </span>be
</span><span id="__span-33-55"><a id="__codelineno-33-55" name="__codelineno-33-55" href="#__codelineno-33-55"></a><span class="w">            </span>specified.
</span><span id="__span-33-56"><a id="__codelineno-33-56" name="__codelineno-33-56" href="#__codelineno-33-56"></a><span class="w">        </span><span class="nt">&lt;/description&gt;</span>
</span><span id="__span-33-57"><a id="__codelineno-33-57" name="__codelineno-33-57" href="#__codelineno-33-57"></a><span class="w">    </span><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-33-58"><a id="__codelineno-33-58" name="__codelineno-33-58" href="#__codelineno-33-58"></a>
</span><span id="__span-33-59"><a id="__codelineno-33-59" name="__codelineno-33-59" href="#__codelineno-33-59"></a><span class="w">    </span><span class="nt">&lt;property&gt;</span>
</span><span id="__span-33-60"><a id="__codelineno-33-60" name="__codelineno-33-60" href="#__codelineno-33-60"></a><span class="w">        </span><span class="nt">&lt;name&gt;</span>ssl.client.keystore.password<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-33-61"><a id="__codelineno-33-61" name="__codelineno-33-61" href="#__codelineno-33-61"></a><span class="w">        </span><span class="nt">&lt;value&gt;</span>xuwangwei3306<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-33-62"><a id="__codelineno-33-62" name="__codelineno-33-62" href="#__codelineno-33-62"></a><span class="w">        </span><span class="nt">&lt;description&gt;</span>Optional.<span class="w"> </span>Default<span class="w"> </span>value<span class="w"> </span>is<span class="w"> </span>&quot;&quot;.
</span><span id="__span-33-63"><a id="__codelineno-33-63" name="__codelineno-33-63" href="#__codelineno-33-63"></a><span class="w">        </span><span class="nt">&lt;/description&gt;</span>
</span><span id="__span-33-64"><a id="__codelineno-33-64" name="__codelineno-33-64" href="#__codelineno-33-64"></a><span class="w">    </span><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-33-65"><a id="__codelineno-33-65" name="__codelineno-33-65" href="#__codelineno-33-65"></a>
</span><span id="__span-33-66"><a id="__codelineno-33-66" name="__codelineno-33-66" href="#__codelineno-33-66"></a><span class="w">    </span><span class="nt">&lt;property&gt;</span>
</span><span id="__span-33-67"><a id="__codelineno-33-67" name="__codelineno-33-67" href="#__codelineno-33-67"></a><span class="w">        </span><span class="nt">&lt;name&gt;</span>ssl.client.keystore.keypassword<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-33-68"><a id="__codelineno-33-68" name="__codelineno-33-68" href="#__codelineno-33-68"></a><span class="w">        </span><span class="nt">&lt;value&gt;</span>xuwangwei3306<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-33-69"><a id="__codelineno-33-69" name="__codelineno-33-69" href="#__codelineno-33-69"></a><span class="w">        </span><span class="nt">&lt;description&gt;</span>Optional.<span class="w"> </span>Default<span class="w"> </span>value<span class="w"> </span>is<span class="w"> </span>&quot;&quot;.
</span><span id="__span-33-70"><a id="__codelineno-33-70" name="__codelineno-33-70" href="#__codelineno-33-70"></a><span class="w">        </span><span class="nt">&lt;/description&gt;</span>
</span><span id="__span-33-71"><a id="__codelineno-33-71" name="__codelineno-33-71" href="#__codelineno-33-71"></a><span class="w">    </span><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-33-72"><a id="__codelineno-33-72" name="__codelineno-33-72" href="#__codelineno-33-72"></a>
</span><span id="__span-33-73"><a id="__codelineno-33-73" name="__codelineno-33-73" href="#__codelineno-33-73"></a><span class="w">    </span><span class="nt">&lt;property&gt;</span>
</span><span id="__span-33-74"><a id="__codelineno-33-74" name="__codelineno-33-74" href="#__codelineno-33-74"></a><span class="w">        </span><span class="nt">&lt;name&gt;</span>ssl.client.keystore.type<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-33-75"><a id="__codelineno-33-75" name="__codelineno-33-75" href="#__codelineno-33-75"></a><span class="w">        </span><span class="nt">&lt;value&gt;</span>pkcs12<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-33-76"><a id="__codelineno-33-76" name="__codelineno-33-76" href="#__codelineno-33-76"></a><span class="w">        </span><span class="nt">&lt;description&gt;</span>Optional.<span class="w"> </span>The<span class="w"> </span>keystore<span class="w"> </span>file<span class="w"> </span>format,<span class="w"> </span>default<span class="w"> </span>value<span class="w"> </span>is<span class="w"> </span>&quot;jks&quot;.
</span><span id="__span-33-77"><a id="__codelineno-33-77" name="__codelineno-33-77" href="#__codelineno-33-77"></a><span class="w">        </span><span class="nt">&lt;/description&gt;</span>
</span><span id="__span-33-78"><a id="__codelineno-33-78" name="__codelineno-33-78" href="#__codelineno-33-78"></a><span class="w">    </span><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-33-79"><a id="__codelineno-33-79" name="__codelineno-33-79" href="#__codelineno-33-79"></a>
</span><span id="__span-33-80"><a id="__codelineno-33-80" name="__codelineno-33-80" href="#__codelineno-33-80"></a><span class="nt">&lt;/configuration&gt;</span>
</span></code></pre></div>
</li>
<li>
<p>创建配置文件 ssl-server.xml</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="cp">&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;configuration.xsl&quot;?&gt;</span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="cm">&lt;!--</span>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="cm">Licensed to the Apache Software Foundation (ASF) under one or more</span>
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a><span class="cm">contributor license agreements.  See the NOTICE file distributed with</span>
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a><span class="cm">this work for additional information regarding copyright ownership.</span>
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a><span class="cm">The ASF licenses this file to You under the Apache License, Version 2.0</span>
</span><span id="__span-34-8"><a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a><span class="cm">(the &quot;License&quot;); you may not use this file except in compliance with</span>
</span><span id="__span-34-9"><a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a><span class="cm">the License.  You may obtain a copy of the License at</span>
</span><span id="__span-34-10"><a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a>
</span><span id="__span-34-11"><a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a><span class="cm">    http://www.apache.org/licenses/LICENSE-2.0</span>
</span><span id="__span-34-12"><a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a>
</span><span id="__span-34-13"><a id="__codelineno-34-13" name="__codelineno-34-13" href="#__codelineno-34-13"></a><span class="cm">Unless required by applicable law or agreed to in writing, software</span>
</span><span id="__span-34-14"><a id="__codelineno-34-14" name="__codelineno-34-14" href="#__codelineno-34-14"></a><span class="cm">distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
</span><span id="__span-34-15"><a id="__codelineno-34-15" name="__codelineno-34-15" href="#__codelineno-34-15"></a><span class="cm">WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
</span><span id="__span-34-16"><a id="__codelineno-34-16" name="__codelineno-34-16" href="#__codelineno-34-16"></a><span class="cm">See the License for the specific language governing permissions and</span>
</span><span id="__span-34-17"><a id="__codelineno-34-17" name="__codelineno-34-17" href="#__codelineno-34-17"></a><span class="cm">limitations under the License.</span>
</span><span id="__span-34-18"><a id="__codelineno-34-18" name="__codelineno-34-18" href="#__codelineno-34-18"></a><span class="cm">--&gt;</span>
</span><span id="__span-34-19"><a id="__codelineno-34-19" name="__codelineno-34-19" href="#__codelineno-34-19"></a><span class="nt">&lt;configuration&gt;</span>
</span><span id="__span-34-20"><a id="__codelineno-34-20" name="__codelineno-34-20" href="#__codelineno-34-20"></a>
</span><span id="__span-34-21"><a id="__codelineno-34-21" name="__codelineno-34-21" href="#__codelineno-34-21"></a><span class="w">    </span><span class="nt">&lt;property&gt;</span>
</span><span id="__span-34-22"><a id="__codelineno-34-22" name="__codelineno-34-22" href="#__codelineno-34-22"></a><span class="w">        </span><span class="nt">&lt;name&gt;</span>ssl.server.truststore.location<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-34-23"><a id="__codelineno-34-23" name="__codelineno-34-23" href="#__codelineno-34-23"></a><span class="w">        </span><span class="nt">&lt;value&gt;</span>/etc/hadoop/hadoop.p12<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-34-24"><a id="__codelineno-34-24" name="__codelineno-34-24" href="#__codelineno-34-24"></a><span class="w">        </span><span class="nt">&lt;description&gt;</span>Truststore<span class="w"> </span>to<span class="w"> </span>be<span class="w"> </span>used<span class="w"> </span>by<span class="w"> </span>NN<span class="w"> </span>and<span class="w"> </span>DN.<span class="w"> </span>Must<span class="w"> </span>be<span class="w"> </span>specified.
</span><span id="__span-34-25"><a id="__codelineno-34-25" name="__codelineno-34-25" href="#__codelineno-34-25"></a><span class="w">        </span><span class="nt">&lt;/description&gt;</span>
</span><span id="__span-34-26"><a id="__codelineno-34-26" name="__codelineno-34-26" href="#__codelineno-34-26"></a><span class="w">    </span><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-34-27"><a id="__codelineno-34-27" name="__codelineno-34-27" href="#__codelineno-34-27"></a>
</span><span id="__span-34-28"><a id="__codelineno-34-28" name="__codelineno-34-28" href="#__codelineno-34-28"></a><span class="w">    </span><span class="nt">&lt;property&gt;</span>
</span><span id="__span-34-29"><a id="__codelineno-34-29" name="__codelineno-34-29" href="#__codelineno-34-29"></a><span class="w">        </span><span class="nt">&lt;name&gt;</span>ssl.server.truststore.password<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-34-30"><a id="__codelineno-34-30" name="__codelineno-34-30" href="#__codelineno-34-30"></a><span class="w">        </span><span class="nt">&lt;value&gt;</span>xuwangwei3306<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-34-31"><a id="__codelineno-34-31" name="__codelineno-34-31" href="#__codelineno-34-31"></a><span class="w">        </span><span class="nt">&lt;description&gt;</span>Optional.<span class="w"> </span>Default<span class="w"> </span>value<span class="w"> </span>is<span class="w"> </span>&quot;&quot;.
</span><span id="__span-34-32"><a id="__codelineno-34-32" name="__codelineno-34-32" href="#__codelineno-34-32"></a><span class="w">        </span><span class="nt">&lt;/description&gt;</span>
</span><span id="__span-34-33"><a id="__codelineno-34-33" name="__codelineno-34-33" href="#__codelineno-34-33"></a><span class="w">    </span><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-34-34"><a id="__codelineno-34-34" name="__codelineno-34-34" href="#__codelineno-34-34"></a>
</span><span id="__span-34-35"><a id="__codelineno-34-35" name="__codelineno-34-35" href="#__codelineno-34-35"></a><span class="w">    </span><span class="nt">&lt;property&gt;</span>
</span><span id="__span-34-36"><a id="__codelineno-34-36" name="__codelineno-34-36" href="#__codelineno-34-36"></a><span class="w">        </span><span class="nt">&lt;name&gt;</span>ssl.server.truststore.type<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-34-37"><a id="__codelineno-34-37" name="__codelineno-34-37" href="#__codelineno-34-37"></a><span class="w">        </span><span class="nt">&lt;value&gt;</span>pkcs12<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-34-38"><a id="__codelineno-34-38" name="__codelineno-34-38" href="#__codelineno-34-38"></a><span class="w">        </span><span class="nt">&lt;description&gt;</span>Optional.<span class="w"> </span>The<span class="w"> </span>keystore<span class="w"> </span>file<span class="w"> </span>format,<span class="w"> </span>default<span class="w"> </span>value<span class="w"> </span>is<span class="w"> </span>&quot;jks&quot;.
</span><span id="__span-34-39"><a id="__codelineno-34-39" name="__codelineno-34-39" href="#__codelineno-34-39"></a><span class="w">        </span><span class="nt">&lt;/description&gt;</span>
</span><span id="__span-34-40"><a id="__codelineno-34-40" name="__codelineno-34-40" href="#__codelineno-34-40"></a><span class="w">    </span><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-34-41"><a id="__codelineno-34-41" name="__codelineno-34-41" href="#__codelineno-34-41"></a>
</span><span id="__span-34-42"><a id="__codelineno-34-42" name="__codelineno-34-42" href="#__codelineno-34-42"></a><span class="w">    </span><span class="nt">&lt;property&gt;</span>
</span><span id="__span-34-43"><a id="__codelineno-34-43" name="__codelineno-34-43" href="#__codelineno-34-43"></a><span class="w">        </span><span class="nt">&lt;name&gt;</span>ssl.server.truststore.reload.interval<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-34-44"><a id="__codelineno-34-44" name="__codelineno-34-44" href="#__codelineno-34-44"></a><span class="w">        </span><span class="nt">&lt;value&gt;</span>10000<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-34-45"><a id="__codelineno-34-45" name="__codelineno-34-45" href="#__codelineno-34-45"></a><span class="w">        </span><span class="nt">&lt;description&gt;</span>Truststore<span class="w"> </span>reload<span class="w"> </span>check<span class="w"> </span>interval,<span class="w"> </span>in<span class="w"> </span>milliseconds.
</span><span id="__span-34-46"><a id="__codelineno-34-46" name="__codelineno-34-46" href="#__codelineno-34-46"></a><span class="w">            </span>Default<span class="w"> </span>value<span class="w"> </span>is<span class="w"> </span>10000<span class="w"> </span>(10<span class="w"> </span>seconds).
</span><span id="__span-34-47"><a id="__codelineno-34-47" name="__codelineno-34-47" href="#__codelineno-34-47"></a><span class="w">        </span><span class="nt">&lt;/description&gt;</span>
</span><span id="__span-34-48"><a id="__codelineno-34-48" name="__codelineno-34-48" href="#__codelineno-34-48"></a><span class="w">    </span><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-34-49"><a id="__codelineno-34-49" name="__codelineno-34-49" href="#__codelineno-34-49"></a>
</span><span id="__span-34-50"><a id="__codelineno-34-50" name="__codelineno-34-50" href="#__codelineno-34-50"></a><span class="w">    </span><span class="nt">&lt;property&gt;</span>
</span><span id="__span-34-51"><a id="__codelineno-34-51" name="__codelineno-34-51" href="#__codelineno-34-51"></a><span class="w">        </span><span class="nt">&lt;name&gt;</span>ssl.server.keystore.location<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-34-52"><a id="__codelineno-34-52" name="__codelineno-34-52" href="#__codelineno-34-52"></a><span class="w">        </span><span class="nt">&lt;value&gt;</span>/etc/hadoop/hadoop.p12<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-34-53"><a id="__codelineno-34-53" name="__codelineno-34-53" href="#__codelineno-34-53"></a><span class="w">        </span><span class="nt">&lt;description&gt;</span>Keystore<span class="w"> </span>to<span class="w"> </span>be<span class="w"> </span>used<span class="w"> </span>by<span class="w"> </span>NN<span class="w"> </span>and<span class="w"> </span>DN.<span class="w"> </span>Must<span class="w"> </span>be<span class="w"> </span>specified.
</span><span id="__span-34-54"><a id="__codelineno-34-54" name="__codelineno-34-54" href="#__codelineno-34-54"></a><span class="w">        </span><span class="nt">&lt;/description&gt;</span>
</span><span id="__span-34-55"><a id="__codelineno-34-55" name="__codelineno-34-55" href="#__codelineno-34-55"></a><span class="w">    </span><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-34-56"><a id="__codelineno-34-56" name="__codelineno-34-56" href="#__codelineno-34-56"></a>
</span><span id="__span-34-57"><a id="__codelineno-34-57" name="__codelineno-34-57" href="#__codelineno-34-57"></a><span class="w">    </span><span class="nt">&lt;property&gt;</span>
</span><span id="__span-34-58"><a id="__codelineno-34-58" name="__codelineno-34-58" href="#__codelineno-34-58"></a><span class="w">        </span><span class="nt">&lt;name&gt;</span>ssl.server.keystore.password<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-34-59"><a id="__codelineno-34-59" name="__codelineno-34-59" href="#__codelineno-34-59"></a><span class="w">        </span><span class="nt">&lt;value&gt;</span>xuwangwei3306<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-34-60"><a id="__codelineno-34-60" name="__codelineno-34-60" href="#__codelineno-34-60"></a><span class="w">        </span><span class="nt">&lt;description&gt;</span>Must<span class="w"> </span>be<span class="w"> </span>specified.
</span><span id="__span-34-61"><a id="__codelineno-34-61" name="__codelineno-34-61" href="#__codelineno-34-61"></a><span class="w">        </span><span class="nt">&lt;/description&gt;</span>
</span><span id="__span-34-62"><a id="__codelineno-34-62" name="__codelineno-34-62" href="#__codelineno-34-62"></a><span class="w">    </span><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-34-63"><a id="__codelineno-34-63" name="__codelineno-34-63" href="#__codelineno-34-63"></a>
</span><span id="__span-34-64"><a id="__codelineno-34-64" name="__codelineno-34-64" href="#__codelineno-34-64"></a><span class="w">    </span><span class="nt">&lt;property&gt;</span>
</span><span id="__span-34-65"><a id="__codelineno-34-65" name="__codelineno-34-65" href="#__codelineno-34-65"></a><span class="w">        </span><span class="nt">&lt;name&gt;</span>ssl.server.keystore.keypassword<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-34-66"><a id="__codelineno-34-66" name="__codelineno-34-66" href="#__codelineno-34-66"></a><span class="w">        </span><span class="nt">&lt;value&gt;</span>xuwangwei3306<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-34-67"><a id="__codelineno-34-67" name="__codelineno-34-67" href="#__codelineno-34-67"></a><span class="w">        </span><span class="nt">&lt;description&gt;</span>Must<span class="w"> </span>be<span class="w"> </span>specified.
</span><span id="__span-34-68"><a id="__codelineno-34-68" name="__codelineno-34-68" href="#__codelineno-34-68"></a><span class="w">        </span><span class="nt">&lt;/description&gt;</span>
</span><span id="__span-34-69"><a id="__codelineno-34-69" name="__codelineno-34-69" href="#__codelineno-34-69"></a><span class="w">    </span><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-34-70"><a id="__codelineno-34-70" name="__codelineno-34-70" href="#__codelineno-34-70"></a>
</span><span id="__span-34-71"><a id="__codelineno-34-71" name="__codelineno-34-71" href="#__codelineno-34-71"></a><span class="w">    </span><span class="nt">&lt;property&gt;</span>
</span><span id="__span-34-72"><a id="__codelineno-34-72" name="__codelineno-34-72" href="#__codelineno-34-72"></a><span class="w">        </span><span class="nt">&lt;name&gt;</span>ssl.server.keystore.type<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-34-73"><a id="__codelineno-34-73" name="__codelineno-34-73" href="#__codelineno-34-73"></a><span class="w">        </span><span class="nt">&lt;value&gt;</span>pkcs12<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-34-74"><a id="__codelineno-34-74" name="__codelineno-34-74" href="#__codelineno-34-74"></a><span class="w">        </span><span class="nt">&lt;description&gt;</span>Optional.<span class="w"> </span>The<span class="w"> </span>keystore<span class="w"> </span>file<span class="w"> </span>format,<span class="w"> </span>default<span class="w"> </span>value<span class="w"> </span>is<span class="w"> </span>&quot;jks&quot;.
</span><span id="__span-34-75"><a id="__codelineno-34-75" name="__codelineno-34-75" href="#__codelineno-34-75"></a><span class="w">        </span><span class="nt">&lt;/description&gt;</span>
</span><span id="__span-34-76"><a id="__codelineno-34-76" name="__codelineno-34-76" href="#__codelineno-34-76"></a><span class="w">    </span><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-34-77"><a id="__codelineno-34-77" name="__codelineno-34-77" href="#__codelineno-34-77"></a>
</span><span id="__span-34-78"><a id="__codelineno-34-78" name="__codelineno-34-78" href="#__codelineno-34-78"></a><span class="w">    </span><span class="nt">&lt;property&gt;</span>
</span><span id="__span-34-79"><a id="__codelineno-34-79" name="__codelineno-34-79" href="#__codelineno-34-79"></a><span class="w">        </span><span class="nt">&lt;name&gt;</span>ssl.server.exclude.cipher.list<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-34-80"><a id="__codelineno-34-80" name="__codelineno-34-80" href="#__codelineno-34-80"></a><span class="w">        </span><span class="nt">&lt;value&gt;</span>TLS_ECDHE_RSA_WITH_RC4_128_SHA,SSL_DHE_RSA_EXPORT_WITH_DES40_CBC_SHA,
</span><span id="__span-34-81"><a id="__codelineno-34-81" name="__codelineno-34-81" href="#__codelineno-34-81"></a><span class="w">            </span>SSL_RSA_WITH_DES_CBC_SHA,SSL_DHE_RSA_WITH_DES_CBC_SHA,
</span><span id="__span-34-82"><a id="__codelineno-34-82" name="__codelineno-34-82" href="#__codelineno-34-82"></a><span class="w">            </span>SSL_RSA_EXPORT_WITH_RC4_40_MD5,SSL_RSA_EXPORT_WITH_DES40_CBC_SHA,
</span><span id="__span-34-83"><a id="__codelineno-34-83" name="__codelineno-34-83" href="#__codelineno-34-83"></a><span class="w">            </span>SSL_RSA_WITH_RC4_128_MD5<span class="nt">&lt;/value&gt;</span>
</span><span id="__span-34-84"><a id="__codelineno-34-84" name="__codelineno-34-84" href="#__codelineno-34-84"></a><span class="w">        </span><span class="nt">&lt;description&gt;</span>Optional.<span class="w"> </span>The<span class="w"> </span>weak<span class="w"> </span>security<span class="w"> </span>cipher<span class="w"> </span>suites<span class="w"> </span>that<span class="w"> </span>you<span class="w"> </span>want<span class="w"> </span>excluded
</span><span id="__span-34-85"><a id="__codelineno-34-85" name="__codelineno-34-85" href="#__codelineno-34-85"></a><span class="w">            </span>from<span class="w"> </span>SSL<span class="w"> </span>communication.<span class="nt">&lt;/description&gt;</span>
</span><span id="__span-34-86"><a id="__codelineno-34-86" name="__codelineno-34-86" href="#__codelineno-34-86"></a><span class="w">    </span><span class="nt">&lt;/property&gt;</span>
</span><span id="__span-34-87"><a id="__codelineno-34-87" name="__codelineno-34-87" href="#__codelineno-34-87"></a>
</span><span id="__span-34-88"><a id="__codelineno-34-88" name="__codelineno-34-88" href="#__codelineno-34-88"></a><span class="nt">&lt;/configuration&gt;</span>
</span></code></pre></div>
</li>
<li>
<p>创建配置文件 jaas.conf</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a>Client {
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>    com.sun.security.auth.module.Krb5LoginModule required
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a>    useKeyTab=true
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a>    keyTab=&quot;/etc/hadoop/hdfs.keytab&quot;
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a>    storeKey=true
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a>    useTicketCache=false
</span><span id="__span-35-7"><a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a>    principal=&quot;hdfs&quot;;
</span><span id="__span-35-8"><a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a>};
</span></code></pre></div>
</li>
<li>
<p>修改配置文件$HADOOP_CONF_DIR/hadoop-env.sh</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;export HADOOP_OPTS=&quot;${HADOOP_OPTS} -Djava.net.preferIPv4Stack=true&quot;&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$HADOOP_CONF_DIR</span>/hadoop-env.sh
</span></code></pre></div>
</li>
</ol>
<hr />
<h2 id="zookeeper">配置ZooKeeper<a class="headerlink" href="#zookeeper" title="Permanent link">&para;</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>下面的命令只需在主机machine1上执行。</p>
</div>
<ol>
<li>
<p>创建配置文件$ZOOCFGDIR/zoo.cfg</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a>mv<span class="w"> </span><span class="nv">$ZOOCFGDIR</span>/zoo_sample.cfg<span class="w"> </span><span class="nv">$ZOOCFGDIR</span>/zoo.cfg
</span></code></pre></div>
</li>
<li>
<p>修改配置文件$ZOOCFGDIR/zoo.cfg</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a># The number of milliseconds of each tick
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a>tickTime=2000
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a># The number of ticks that the initial 
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a># synchronization phase can take
</span><span id="__span-38-5"><a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a>initLimit=10
</span><span id="__span-38-6"><a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a># The number of ticks that can pass between 
</span><span id="__span-38-7"><a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a># sending a request and getting an acknowledgement
</span><span id="__span-38-8"><a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a>syncLimit=5
</span><span id="__span-38-9"><a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a># the directory where the snapshot is stored.
</span><span id="__span-38-10"><a id="__codelineno-38-10" name="__codelineno-38-10" href="#__codelineno-38-10"></a># do not use /tmp for storage, /tmp here is just 
</span><span id="__span-38-11"><a id="__codelineno-38-11" name="__codelineno-38-11" href="#__codelineno-38-11"></a># example sakes.
</span><span id="__span-38-12"><a id="__codelineno-38-12" name="__codelineno-38-12" href="#__codelineno-38-12"></a>dataDir=/var/lib/zookeeper
</span><span id="__span-38-13"><a id="__codelineno-38-13" name="__codelineno-38-13" href="#__codelineno-38-13"></a># the port at which the clients will connect
</span><span id="__span-38-14"><a id="__codelineno-38-14" name="__codelineno-38-14" href="#__codelineno-38-14"></a>clientPort=2181
</span><span id="__span-38-15"><a id="__codelineno-38-15" name="__codelineno-38-15" href="#__codelineno-38-15"></a># the maximum number of client connections.
</span><span id="__span-38-16"><a id="__codelineno-38-16" name="__codelineno-38-16" href="#__codelineno-38-16"></a># increase this if you need to handle more clients
</span><span id="__span-38-17"><a id="__codelineno-38-17" name="__codelineno-38-17" href="#__codelineno-38-17"></a>#maxClientCnxns=60
</span><span id="__span-38-18"><a id="__codelineno-38-18" name="__codelineno-38-18" href="#__codelineno-38-18"></a>#
</span><span id="__span-38-19"><a id="__codelineno-38-19" name="__codelineno-38-19" href="#__codelineno-38-19"></a># Be sure to read the maintenance section of the 
</span><span id="__span-38-20"><a id="__codelineno-38-20" name="__codelineno-38-20" href="#__codelineno-38-20"></a># administrator guide before turning on autopurge.
</span><span id="__span-38-21"><a id="__codelineno-38-21" name="__codelineno-38-21" href="#__codelineno-38-21"></a>#
</span><span id="__span-38-22"><a id="__codelineno-38-22" name="__codelineno-38-22" href="#__codelineno-38-22"></a># http://zookeeper.apache.org/doc/current/zookeeperAdmin.html#sc_maintenance
</span><span id="__span-38-23"><a id="__codelineno-38-23" name="__codelineno-38-23" href="#__codelineno-38-23"></a>#
</span><span id="__span-38-24"><a id="__codelineno-38-24" name="__codelineno-38-24" href="#__codelineno-38-24"></a># The number of snapshots to retain in dataDir
</span><span id="__span-38-25"><a id="__codelineno-38-25" name="__codelineno-38-25" href="#__codelineno-38-25"></a>#autopurge.snapRetainCount=3
</span><span id="__span-38-26"><a id="__codelineno-38-26" name="__codelineno-38-26" href="#__codelineno-38-26"></a># Purge task interval in hours
</span><span id="__span-38-27"><a id="__codelineno-38-27" name="__codelineno-38-27" href="#__codelineno-38-27"></a># Set to &quot;0&quot; to disable auto purge feature
</span><span id="__span-38-28"><a id="__codelineno-38-28" name="__codelineno-38-28" href="#__codelineno-38-28"></a>#autopurge.purgeInterval=1
</span><span id="__span-38-29"><a id="__codelineno-38-29" name="__codelineno-38-29" href="#__codelineno-38-29"></a>
</span><span id="__span-38-30"><a id="__codelineno-38-30" name="__codelineno-38-30" href="#__codelineno-38-30"></a>## Metrics Providers
</span><span id="__span-38-31"><a id="__codelineno-38-31" name="__codelineno-38-31" href="#__codelineno-38-31"></a>#
</span><span id="__span-38-32"><a id="__codelineno-38-32" name="__codelineno-38-32" href="#__codelineno-38-32"></a># https://prometheus.io Metrics Exporter
</span><span id="__span-38-33"><a id="__codelineno-38-33" name="__codelineno-38-33" href="#__codelineno-38-33"></a>#metricsProvider.className=org.apache.zookeeper.metrics.prometheus.PrometheusMetricsProvider
</span><span id="__span-38-34"><a id="__codelineno-38-34" name="__codelineno-38-34" href="#__codelineno-38-34"></a>#metricsProvider.httpPort=7000
</span><span id="__span-38-35"><a id="__codelineno-38-35" name="__codelineno-38-35" href="#__codelineno-38-35"></a>#metricsProvider.exportJvmInfo=true
</span><span id="__span-38-36"><a id="__codelineno-38-36" name="__codelineno-38-36" href="#__codelineno-38-36"></a>
</span><span id="__span-38-37"><a id="__codelineno-38-37" name="__codelineno-38-37" href="#__codelineno-38-37"></a>server.1=machine1.xuwangwei.test:2888:3888
</span><span id="__span-38-38"><a id="__codelineno-38-38" name="__codelineno-38-38" href="#__codelineno-38-38"></a>server.2=machine2.xuwangwei.test:2888:3888
</span><span id="__span-38-39"><a id="__codelineno-38-39" name="__codelineno-38-39" href="#__codelineno-38-39"></a>server.3=machine3.xuwangwei.test:2888:3888
</span><span id="__span-38-40"><a id="__codelineno-38-40" name="__codelineno-38-40" href="#__codelineno-38-40"></a>server.4=machine4.xuwangwei.test:2888:3888
</span><span id="__span-38-41"><a id="__codelineno-38-41" name="__codelineno-38-41" href="#__codelineno-38-41"></a>server.5=machine5.xuwangwei.test:2888:3888
</span><span id="__span-38-42"><a id="__codelineno-38-42" name="__codelineno-38-42" href="#__codelineno-38-42"></a>
</span><span id="__span-38-43"><a id="__codelineno-38-43" name="__codelineno-38-43" href="#__codelineno-38-43"></a>enforce.auth.enabled=true
</span><span id="__span-38-44"><a id="__codelineno-38-44" name="__codelineno-38-44" href="#__codelineno-38-44"></a>enforce.auth.schemes=sasl
</span><span id="__span-38-45"><a id="__codelineno-38-45" name="__codelineno-38-45" href="#__codelineno-38-45"></a>authProvider.1=org.apache.zookeeper.server.auth.SASLAuthenticationProvider 
</span><span id="__span-38-46"><a id="__codelineno-38-46" name="__codelineno-38-46" href="#__codelineno-38-46"></a># optional SASL related server-side properties:
</span><span id="__span-38-47"><a id="__codelineno-38-47" name="__codelineno-38-47" href="#__codelineno-38-47"></a># you can instruct ZooKeeper to remove the host from the client principal name during authentication
</span><span id="__span-38-48"><a id="__codelineno-38-48" name="__codelineno-38-48" href="#__codelineno-38-48"></a># (e.g. zk/myhost@EXAMPLE.COM client principal will be authenticated in ZooKeeper as zk@EXAMPLE.COM)
</span><span id="__span-38-49"><a id="__codelineno-38-49" name="__codelineno-38-49" href="#__codelineno-38-49"></a>kerberos.removeHostFromPrincipal=true
</span><span id="__span-38-50"><a id="__codelineno-38-50" name="__codelineno-38-50" href="#__codelineno-38-50"></a># you can instruct ZooKeeper to remove the realm from the client principal name during authentication
</span><span id="__span-38-51"><a id="__codelineno-38-51" name="__codelineno-38-51" href="#__codelineno-38-51"></a># (e.g. zk/myhost@EXAMPLE.COM client principal will be authenticated in ZooKeeper as zk/myhost)
</span><span id="__span-38-52"><a id="__codelineno-38-52" name="__codelineno-38-52" href="#__codelineno-38-52"></a>kerberos.removeRealmFromPrincipal=true
</span></code></pre></div>
</li>
<li>
<p>创建配置文件/etc/zookeeper_no_share/jaas.conf，由于该配置文件无法配置 zookeeper/_HOST 这种统一的服务 principal，所以这个配置无法共享，单独放在了一个目录下。每台机器上的此配置都要修改 Server 下 principal。</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a>Server {
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a>    com.sun.security.auth.module.Krb5LoginModule required
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a>    useKeyTab=true
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a>    keyTab=&quot;/etc/zookeeper/zookeeper.keytab&quot;
</span><span id="__span-39-5"><a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a>    storeKey=true
</span><span id="__span-39-6"><a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a>    useTicketCache=false
</span><span id="__span-39-7"><a id="__codelineno-39-7" name="__codelineno-39-7" href="#__codelineno-39-7"></a>    principal=&quot;zookeeper/machine1.xuwangwei.test&quot;;
</span><span id="__span-39-8"><a id="__codelineno-39-8" name="__codelineno-39-8" href="#__codelineno-39-8"></a>};
</span><span id="__span-39-9"><a id="__codelineno-39-9" name="__codelineno-39-9" href="#__codelineno-39-9"></a>Client {
</span><span id="__span-39-10"><a id="__codelineno-39-10" name="__codelineno-39-10" href="#__codelineno-39-10"></a>    com.sun.security.auth.module.Krb5LoginModule required
</span><span id="__span-39-11"><a id="__codelineno-39-11" name="__codelineno-39-11" href="#__codelineno-39-11"></a>    useKeyTab=true
</span><span id="__span-39-12"><a id="__codelineno-39-12" name="__codelineno-39-12" href="#__codelineno-39-12"></a>    keyTab=&quot;/etc/zookeeper/zookeeper.keytab&quot;
</span><span id="__span-39-13"><a id="__codelineno-39-13" name="__codelineno-39-13" href="#__codelineno-39-13"></a>    storeKey=true
</span><span id="__span-39-14"><a id="__codelineno-39-14" name="__codelineno-39-14" href="#__codelineno-39-14"></a>    useTicketCache=false
</span><span id="__span-39-15"><a id="__codelineno-39-15" name="__codelineno-39-15" href="#__codelineno-39-15"></a>    principal=&quot;zookeeper&quot;;
</span><span id="__span-39-16"><a id="__codelineno-39-16" name="__codelineno-39-16" href="#__codelineno-39-16"></a>};
</span></code></pre></div>
</li>
<li>
<p>创建配置文件$ZOOCFGDIR/java.env</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="nv">SERVER_JVMFLAGS</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">SERVER_JVMFLAGS</span><span class="si">}</span><span class="s2"> -Djava.security.auth.login.config=/etc/zookeeper_no_share/jaas.conf&quot;</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="nv">CLIENT_JVMFLAGS</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">CLIENT_JVMFLAGS</span><span class="si">}</span><span class="s2"> -Djava.security.auth.login.config=/etc/zookeeper_no_share/jaas.conf&quot;</span>
</span></code></pre></div>
</li>
<li>
<p>在数据目录（即zoo.cfg中配置的dataDir）下创建myid文件和initialize空文件，myid文件内容是本实例在集群中的id。</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a>su<span class="w"> </span>-<span class="w"> </span>zookeeper
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a>ssh<span class="w"> </span>machine1<span class="w"> </span><span class="s1">&#39;echo 1 &gt; /var/lib/zookeeper/myid;touch /var/lib/zookeeper/initialize&#39;</span>
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a>ssh<span class="w"> </span>machine2<span class="w"> </span><span class="s1">&#39;echo 2 &gt; /var/lib/zookeeper/myid;touch /var/lib/zookeeper/initialize&#39;</span>
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a>ssh<span class="w"> </span>machine3<span class="w"> </span><span class="s1">&#39;echo 3 &gt; /var/lib/zookeeper/myid;touch /var/lib/zookeeper/initialize&#39;</span>
</span><span id="__span-41-5"><a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a>ssh<span class="w"> </span>machine4<span class="w"> </span><span class="s1">&#39;echo 4 &gt; /var/lib/zookeeper/myid;touch /var/lib/zookeeper/initialize&#39;</span>
</span><span id="__span-41-6"><a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a>ssh<span class="w"> </span>machine5<span class="w"> </span><span class="s1">&#39;echo 5 &gt; /var/lib/zookeeper/myid;touch /var/lib/zookeeper/initialize&#39;</span>
</span><span id="__span-41-7"><a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a><span class="nb">exit</span>
</span></code></pre></div>
</li>
</ol>
<hr />
<h2 id="zookeeper_1">启动ZooKeeper<a class="headerlink" href="#zookeeper_1" title="Permanent link">&para;</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>下面的命令只需在主机machine1上执行。</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a>su<span class="w"> </span>-<span class="w"> </span>zookeeper
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a>ssh<span class="w"> </span>machine1<span class="w"> </span><span class="s1">&#39;zkServer.sh start&#39;</span>
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a>ssh<span class="w"> </span>machine2<span class="w"> </span><span class="s1">&#39;zkServer.sh start&#39;</span>
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a>ssh<span class="w"> </span>machine3<span class="w"> </span><span class="s1">&#39;zkServer.sh start&#39;</span>
</span><span id="__span-42-5"><a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a>ssh<span class="w"> </span>machine4<span class="w"> </span><span class="s1">&#39;zkServer.sh start&#39;</span>
</span><span id="__span-42-6"><a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a>ssh<span class="w"> </span>machine5<span class="w"> </span><span class="s1">&#39;zkServer.sh start&#39;</span>
</span><span id="__span-42-7"><a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a><span class="nb">exit</span>
</span></code></pre></div>
</div>
<hr />
<h2 id="hadoop_1">启动Hadoop<a class="headerlink" href="#hadoop_1" title="Permanent link">&para;</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>下面的命令只需在主机machine1上执行。</p>
</div>
<ol>
<li>
<p>启动 HDFS</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a>su<span class="w"> </span>-<span class="w"> </span>hdfs<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;ssh machine1 &#39;hdfs --daemon start journalnode&#39;&quot;</span>
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a>su<span class="w"> </span>-<span class="w"> </span>hdfs<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;ssh machine2 &#39;hdfs --daemon start journalnode&#39;&quot;</span>
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a>su<span class="w"> </span>-<span class="w"> </span>hdfs<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;ssh machine3 &#39;hdfs --daemon start journalnode&#39;&quot;</span>
</span><span id="__span-43-4"><a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a>su<span class="w"> </span>-<span class="w"> </span>hdfs<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;hdfs namenode -format&quot;</span>
</span><span id="__span-43-5"><a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a>su<span class="w"> </span>-<span class="w"> </span>hdfs<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;hdfs zkfc -formatZK&quot;</span>
</span><span id="__span-43-6"><a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a>su<span class="w"> </span>-<span class="w"> </span>hdfs<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;start-dfs.sh&quot;</span>
</span><span id="__span-43-7"><a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a>su<span class="w"> </span>-<span class="w"> </span>hdfs<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;ssh machine2 &#39;hdfs namenode -bootstrapStandby&#39;&quot;</span>
</span><span id="__span-43-8"><a id="__codelineno-43-8" name="__codelineno-43-8" href="#__codelineno-43-8"></a>su<span class="w"> </span>-<span class="w"> </span>hdfs<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;ssh machine3 &#39;hdfs namenode -bootstrapStandby&#39;&quot;</span>
</span><span id="__span-43-9"><a id="__codelineno-43-9" name="__codelineno-43-9" href="#__codelineno-43-9"></a>su<span class="w"> </span>-<span class="w"> </span>hdfs<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;stop-dfs.sh;start-dfs.sh&quot;</span>
</span></code></pre></div>
</li>
<li>
<p>修改用户 hdfs 的环境变量</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;export KRB5CCNAME=FILE:/tmp/krb5cc_$UID&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~hdfs/.bashrc
</span></code></pre></div>
<p>hadoop 命令不支持 FreeIPA 安装后的<code>default_ccache_name</code>配置项（KCM），所以我通过改变 hdfs 用户的环境变量，使得 hdfs 用户使用 kinit 命令进行 Kerberos 身份认证时，使用/tmp/krb5cc_$UID的 credential cache。</p>
</li>
<li>
<p>使用 hdfs@XUWANGWEI.TEST 帐号进行 Kerberos 认证</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a>su<span class="w"> </span>-<span class="w"> </span>hdfs<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;kinit -kt /etc/hadoop/hdfs.keytab hdfs&quot;</span>
</span></code></pre></div>
</li>
<li>
<p>初始化目录</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a>su<span class="w"> </span>-<span class="w"> </span>hdfs<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;hadoop fs -chown hdfs:hadoop /&quot;</span>
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a>su<span class="w"> </span>-<span class="w"> </span>hdfs<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;hadoop fs -mkdir /tmp /user&quot;</span>
</span><span id="__span-46-3"><a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a>su<span class="w"> </span>-<span class="w"> </span>hdfs<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;hadoop fs -chmod 1777 /tmp&quot;</span>
</span></code></pre></div>
</li>
<li>
<p>启动 YARN</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a>su<span class="w"> </span>-<span class="w"> </span>yarn<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;start-yarn.sh&quot;</span>
</span></code></pre></div>
</li>
<li>
<p>启动 MapReduce</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a>su<span class="w"> </span>-<span class="w"> </span>mapred<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;mapred --daemon start historyserver&quot;</span>
</span></code></pre></div>
</li>
</ol>







  
  



  


  



      
    </article>
  </div>

          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../../../..", "features": ["content.code.copy", "content.code.annotate", "content.tooltips", "navigation.tabs", "navigation.indexes", "navigation.top", "toc.follow"], "search": "../../../../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>